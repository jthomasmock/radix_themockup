<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">

<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
  <meta name="generator" content="distill" />

  <style type="text/css">
  /* Hide doc at startup (prevent jankiness while JS renders/transforms) */
  body {
    visibility: hidden;
  }
  </style>

 <!--radix_placeholder_import_source-->
 <!--/radix_placeholder_import_source-->

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ad0000; } /* Alert */
code span.an { color: #5e5e5e; } /* Annotation */
code span.at { color: #20794d; } /* Attribute */
code span.bn { color: #ad0000; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007ba5; } /* ControlFlow */
code span.ch { color: #20794d; } /* Char */
code span.cn { color: #8f5902; } /* Constant */
code span.co { color: #5e5e5e; } /* Comment */
code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
code span.dt { color: #ad0000; } /* DataType */
code span.dv { color: #ad0000; } /* DecVal */
code span.er { color: #ad0000; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #ad0000; } /* Float */
code span.fu { color: #4758ab; } /* Function */
code span.im { } /* Import */
code span.in { color: #5e5e5e; } /* Information */
code span.kw { color: #007ba5; } /* Keyword */
code span.op { color: #5e5e5e; } /* Operator */
code span.ot { color: #007ba5; } /* Other */
code span.pp { color: #ad0000; } /* Preprocessor */
code span.sc { color: #20794d; } /* SpecialChar */
code span.ss { color: #20794d; } /* SpecialString */
code span.st { color: #20794d; } /* String */
code span.va { color: #111111; } /* Variable */
code span.vs { color: #20794d; } /* VerbatimString */
code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
</style>

  <!--radix_placeholder_meta_tags-->
<title>The Mockup Blog: Reading tables from images with magick</title>

<meta property="description" itemprop="description" content="magick is an R package for manipulating images in R"/>

<link rel="canonical" href="https://themockup.blog/posts/2021-01-18-reading-tables-from-images-with-magick/"/>

<!--  https://schema.org/Article -->
<meta property="article:published" itemprop="datePublished" content="2021-01-18"/>
<meta property="article:created" itemprop="dateCreated" content="2021-01-18"/>
<meta name="article:author" content="Thomas Mock"/>

<!--  https://developers.facebook.com/docs/sharing/webmasters#markup -->
<meta property="og:title" content="The Mockup Blog: Reading tables from images with magick"/>
<meta property="og:type" content="article"/>
<meta property="og:description" content="magick is an R package for manipulating images in R"/>
<meta property="og:url" content="https://themockup.blog/posts/2021-01-18-reading-tables-from-images-with-magick/"/>
<meta property="og:image" content="https://themockup.blog/posts/2021-01-18-reading-tables-from-images-with-magick/norm_normal_file_format.png"/>
<meta property="og:image:width" content="303"/>
<meta property="og:image:height" content="474"/>
<meta property="og:locale" content="en_US"/>
<meta property="og:site_name" content="The Mockup Blog"/>

<!--  https://dev.twitter.com/cards/types/summary -->
<meta property="twitter:card" content="summary_large_image"/>
<meta property="twitter:title" content="The Mockup Blog: Reading tables from images with magick"/>
<meta property="twitter:description" content="magick is an R package for manipulating images in R"/>
<meta property="twitter:url" content="https://themockup.blog/posts/2021-01-18-reading-tables-from-images-with-magick/"/>
<meta property="twitter:image" content="https://themockup.blog/posts/2021-01-18-reading-tables-from-images-with-magick/norm_normal_file_format.png"/>
<meta property="twitter:image:width" content="303"/>
<meta property="twitter:image:height" content="474"/>
<meta property="twitter:site" content="@thomas_mock"/>
<meta property="twitter:creator" content="@thomas_mock"/>

<!--  https://scholar.google.com/intl/en/scholar/inclusion.html#indexing -->
<meta name="citation_title" content="The Mockup Blog: Reading tables from images with magick"/>
<meta name="citation_fulltext_html_url" content="https://themockup.blog/posts/2021-01-18-reading-tables-from-images-with-magick/"/>
<meta name="citation_online_date" content="2021/01/18"/>
<meta name="citation_publication_date" content="2021/01/18"/>
<meta name="citation_author" content="Thomas Mock"/>
<!--/radix_placeholder_meta_tags-->
  <!--radix_placeholder_rmarkdown_metadata-->

<script type="text/json" id="radix-rmarkdown-metadata">
{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["title","description","author","date","output","preview","twitter","categories","citation_url","canonical_url"]}},"value":[{"type":"character","attributes":{},"value":["Reading tables from images with magick"]},{"type":"character","attributes":{},"value":["magick is an R package for manipulating images in R"]},{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","url"]}},"value":[{"type":"character","attributes":{},"value":["Thomas Mock"]},{"type":"character","attributes":{},"value":["https://twitter.com/thomas_mock"]}]}]},{"type":"character","attributes":{},"value":["01-18-2021"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["distill::distill_article"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["toc","toc_depth","self_contained","highlight","highlight_downlit"]}},"value":[{"type":"logical","attributes":{},"value":[true]},{"type":"integer","attributes":{},"value":[3]},{"type":"logical","attributes":{},"value":[false]},{"type":"character","attributes":{},"value":["default"]},{"type":"logical","attributes":{},"value":[true]}]}]},{"type":"character","attributes":{},"value":["norm_normal_file_format.png"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["site","creator"]}},"value":[{"type":"character","attributes":{},"value":["@thomas_mock"]},{"type":"character","attributes":{},"value":["@thomas_mock"]}]},{"type":"character","attributes":{},"value":["magick","web scraping"]},{"type":"character","attributes":{},"value":["https://themockup.blog/posts/2021-01-18-reading-tables-from-images-with-magick/"]},{"type":"character","attributes":{},"value":["https://themockup.blog/posts/2021-01-18-reading-tables-from-images-with-magick/"]}]}
</script>
<!--/radix_placeholder_rmarkdown_metadata-->
  
  <script type="text/json" id="radix-resource-manifest">
  {"type":"character","attributes":{},"value":["norm_normal_file_format.png","reading-tables-from-images-with-magick_files/anchor-4.2.2/anchor.min.js","reading-tables-from-images-with-magick_files/bowser-1.9.3/bowser.min.js","reading-tables-from-images-with-magick_files/distill-2.2.21/template.v2.js","reading-tables-from-images-with-magick_files/figure-html5/unnamed-chunk-10-1.png","reading-tables-from-images-with-magick_files/figure-html5/unnamed-chunk-11-1.png","reading-tables-from-images-with-magick_files/figure-html5/unnamed-chunk-12-1.png","reading-tables-from-images-with-magick_files/figure-html5/unnamed-chunk-2-1.png","reading-tables-from-images-with-magick_files/figure-html5/unnamed-chunk-20-1.png","reading-tables-from-images-with-magick_files/figure-html5/unnamed-chunk-21-1.png","reading-tables-from-images-with-magick_files/figure-html5/unnamed-chunk-22-1.png","reading-tables-from-images-with-magick_files/figure-html5/unnamed-chunk-23-1.png","reading-tables-from-images-with-magick_files/figure-html5/unnamed-chunk-24-1.png","reading-tables-from-images-with-magick_files/figure-html5/unnamed-chunk-25-1.png","reading-tables-from-images-with-magick_files/figure-html5/unnamed-chunk-26-1.png","reading-tables-from-images-with-magick_files/figure-html5/unnamed-chunk-27-1.png","reading-tables-from-images-with-magick_files/figure-html5/unnamed-chunk-28-1.png","reading-tables-from-images-with-magick_files/figure-html5/unnamed-chunk-3-1.png","reading-tables-from-images-with-magick_files/figure-html5/unnamed-chunk-30-1.png","reading-tables-from-images-with-magick_files/figure-html5/unnamed-chunk-31-1.png","reading-tables-from-images-with-magick_files/figure-html5/unnamed-chunk-32-1.png","reading-tables-from-images-with-magick_files/figure-html5/unnamed-chunk-33-1.png","reading-tables-from-images-with-magick_files/figure-html5/unnamed-chunk-34-1.png","reading-tables-from-images-with-magick_files/figure-html5/unnamed-chunk-4-1.png","reading-tables-from-images-with-magick_files/figure-html5/unnamed-chunk-5-1.png","reading-tables-from-images-with-magick_files/figure-html5/unnamed-chunk-6-1.png","reading-tables-from-images-with-magick_files/figure-html5/unnamed-chunk-7-1.png","reading-tables-from-images-with-magick_files/figure-html5/unnamed-chunk-8-1.png","reading-tables-from-images-with-magick_files/figure-html5/unnamed-chunk-9-1.png","reading-tables-from-images-with-magick_files/header-attrs-2.7.0/header-attrs.js","reading-tables-from-images-with-magick_files/jquery-1.11.3/jquery.min.js","reading-tables-from-images-with-magick_files/webcomponents-2.0.0/webcomponents.js"]}
  </script>
  <!--radix_placeholder_navigation_in_header-->
<meta name="distill:offset" content="../.."/>

<script type="application/javascript">

  window.headroom_prevent_pin = false;

  window.document.addEventListener("DOMContentLoaded", function (event) {

    // initialize headroom for banner
    var header = $('header').get(0);
    var headerHeight = header.offsetHeight;
    var headroom = new Headroom(header, {
      tolerance: 5,
      onPin : function() {
        if (window.headroom_prevent_pin) {
          window.headroom_prevent_pin = false;
          headroom.unpin();
        }
      }
    });
    headroom.init();
    if(window.location.hash)
      headroom.unpin();
    $(header).addClass('headroom--transition');

    // offset scroll location for banner on hash change
    // (see: https://github.com/WickyNilliams/headroom.js/issues/38)
    window.addEventListener("hashchange", function(event) {
      window.scrollTo(0, window.pageYOffset - (headerHeight + 25));
    });

    // responsive menu
    $('.distill-site-header').each(function(i, val) {
      var topnav = $(this);
      var toggle = topnav.find('.nav-toggle');
      toggle.on('click', function() {
        topnav.toggleClass('responsive');
      });
    });

    // nav dropdowns
    $('.nav-dropbtn').click(function(e) {
      $(this).next('.nav-dropdown-content').toggleClass('nav-dropdown-active');
      $(this).parent().siblings('.nav-dropdown')
         .children('.nav-dropdown-content').removeClass('nav-dropdown-active');
    });
    $("body").click(function(e){
      $('.nav-dropdown-content').removeClass('nav-dropdown-active');
    });
    $(".nav-dropdown").click(function(e){
      e.stopPropagation();
    });
  });
</script>

<style type="text/css">

/* Theme (user-documented overrideables for nav appearance) */

.distill-site-nav {
  color: rgba(255, 255, 255, 0.8);
  background-color: #0F2E3D;
  font-size: 15px;
  font-weight: 300;
}

.distill-site-nav a {
  color: inherit;
  text-decoration: none;
}

.distill-site-nav a:hover {
  color: white;
}

@media print {
  .distill-site-nav {
    display: none;
  }
}

.distill-site-header {

}

.distill-site-footer {

}


/* Site Header */

.distill-site-header {
  width: 100%;
  box-sizing: border-box;
  z-index: 3;
}

.distill-site-header .nav-left {
  display: inline-block;
  margin-left: 8px;
}

@media screen and (max-width: 768px) {
  .distill-site-header .nav-left {
    margin-left: 0;
  }
}


.distill-site-header .nav-right {
  float: right;
  margin-right: 8px;
}

.distill-site-header a,
.distill-site-header .title {
  display: inline-block;
  text-align: center;
  padding: 14px 10px 14px 10px;
}

.distill-site-header .title {
  font-size: 18px;
  min-width: 150px;
}

.distill-site-header .logo {
  padding: 0;
}

.distill-site-header .logo img {
  display: none;
  max-height: 20px;
  width: auto;
  margin-bottom: -4px;
}

.distill-site-header .nav-image img {
  max-height: 18px;
  width: auto;
  display: inline-block;
  margin-bottom: -3px;
}



@media screen and (min-width: 1000px) {
  .distill-site-header .logo img {
    display: inline-block;
  }
  .distill-site-header .nav-left {
    margin-left: 20px;
  }
  .distill-site-header .nav-right {
    margin-right: 20px;
  }
  .distill-site-header .title {
    padding-left: 12px;
  }
}


.distill-site-header .nav-toggle {
  display: none;
}

.nav-dropdown {
  display: inline-block;
  position: relative;
}

.nav-dropdown .nav-dropbtn {
  border: none;
  outline: none;
  color: rgba(255, 255, 255, 0.8);
  padding: 16px 10px;
  background-color: transparent;
  font-family: inherit;
  font-size: inherit;
  font-weight: inherit;
  margin: 0;
  margin-top: 1px;
  z-index: 2;
}

.nav-dropdown-content {
  display: none;
  position: absolute;
  background-color: white;
  min-width: 200px;
  border: 1px solid rgba(0,0,0,0.15);
  border-radius: 4px;
  box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.1);
  z-index: 1;
  margin-top: 2px;
  white-space: nowrap;
  padding-top: 4px;
  padding-bottom: 4px;
}

.nav-dropdown-content hr {
  margin-top: 4px;
  margin-bottom: 4px;
  border: none;
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.nav-dropdown-active {
  display: block;
}

.nav-dropdown-content a, .nav-dropdown-content .nav-dropdown-header {
  color: black;
  padding: 6px 24px;
  text-decoration: none;
  display: block;
  text-align: left;
}

.nav-dropdown-content .nav-dropdown-header {
  display: block;
  padding: 5px 24px;
  padding-bottom: 0;
  text-transform: uppercase;
  font-size: 14px;
  color: #999999;
  white-space: nowrap;
}

.nav-dropdown:hover .nav-dropbtn {
  color: white;
}

.nav-dropdown-content a:hover {
  background-color: #ddd;
  color: black;
}

.nav-right .nav-dropdown-content {
  margin-left: -45%;
  right: 0;
}

@media screen and (max-width: 768px) {
  .distill-site-header a, .distill-site-header .nav-dropdown  {display: none;}
  .distill-site-header a.nav-toggle {
    float: right;
    display: block;
  }
  .distill-site-header .title {
    margin-left: 0;
  }
  .distill-site-header .nav-right {
    margin-right: 0;
  }
  .distill-site-header {
    overflow: hidden;
  }
  .nav-right .nav-dropdown-content {
    margin-left: 0;
  }
}


@media screen and (max-width: 768px) {
  .distill-site-header.responsive {position: relative; min-height: 500px; }
  .distill-site-header.responsive a.nav-toggle {
    position: absolute;
    right: 0;
    top: 0;
  }
  .distill-site-header.responsive a,
  .distill-site-header.responsive .nav-dropdown {
    display: block;
    text-align: left;
  }
  .distill-site-header.responsive .nav-left,
  .distill-site-header.responsive .nav-right {
    width: 100%;
  }
  .distill-site-header.responsive .nav-dropdown {float: none;}
  .distill-site-header.responsive .nav-dropdown-content {position: relative;}
  .distill-site-header.responsive .nav-dropdown .nav-dropbtn {
    display: block;
    width: 100%;
    text-align: left;
  }
}

/* Site Footer */

.distill-site-footer {
  width: 100%;
  overflow: hidden;
  box-sizing: border-box;
  z-index: 3;
  margin-top: 30px;
  padding-top: 30px;
  padding-bottom: 30px;
  text-align: center;
}

/* Headroom */

d-title {
  padding-top: 6rem;
}

@media print {
  d-title {
    padding-top: 4rem;
  }
}

.headroom {
  z-index: 1000;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
}

.headroom--transition {
  transition: all .4s ease-in-out;
}

.headroom--unpinned {
  top: -100px;
}

.headroom--pinned {
  top: 0;
}

/* adjust viewport for navbar height */
/* helps vertically center bootstrap (non-distill) content */
.min-vh-100 {
  min-height: calc(100vh - 100px) !important;
}

</style>

<script src="../../site_libs/jquery-1.11.3/jquery.min.js"></script>
<link href="../../site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet"/>
<link href="../../site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet"/>
<script src="../../site_libs/headroom-0.9.4/headroom.min.js"></script>
<script src="../../site_libs/autocomplete-0.37.1/autocomplete.min.js"></script>
<script src="../../site_libs/fuse-6.4.1/fuse.min.js"></script>

<script type="application/javascript">

function getMeta(metaName) {
  var metas = document.getElementsByTagName('meta');
  for (let i = 0; i < metas.length; i++) {
    if (metas[i].getAttribute('name') === metaName) {
      return metas[i].getAttribute('content');
    }
  }
  return '';
}

function offsetURL(url) {
  var offset = getMeta('distill:offset');
  return offset ? offset + '/' + url : url;
}

function createFuseIndex() {

  // create fuse index
  var options = {
    keys: [
      { name: 'title', weight: 20 },
      { name: 'categories', weight: 15 },
      { name: 'description', weight: 10 },
      { name: 'contents', weight: 5 },
    ],
    ignoreLocation: true,
    threshold: 0
  };
  var fuse = new window.Fuse([], options);

  // fetch the main search.json
  return fetch(offsetURL('search.json'))
    .then(function(response) {
      if (response.status == 200) {
        return response.json().then(function(json) {
          // index main articles
          json.articles.forEach(function(article) {
            fuse.add(article);
          });
          // download collections and index their articles
          return Promise.all(json.collections.map(function(collection) {
            return fetch(offsetURL(collection)).then(function(response) {
              if (response.status === 200) {
                return response.json().then(function(articles) {
                  articles.forEach(function(article) {
                    fuse.add(article);
                  });
                })
              } else {
                return Promise.reject(
                  new Error('Unexpected status from search index request: ' +
                            response.status)
                );
              }
            });
          })).then(function() {
            return fuse;
          });
        });

      } else {
        return Promise.reject(
          new Error('Unexpected status from search index request: ' +
                      response.status)
        );
      }
    });
}

window.document.addEventListener("DOMContentLoaded", function (event) {

  // get search element (bail if we don't have one)
  var searchEl = window.document.getElementById('distill-search');
  if (!searchEl)
    return;

  createFuseIndex()
    .then(function(fuse) {

      // make search box visible
      searchEl.classList.remove('hidden');

      // initialize autocomplete
      var options = {
        autoselect: true,
        hint: false,
        minLength: 2,
      };
      window.autocomplete(searchEl, options, [{
        source: function(query, callback) {
          const searchOptions = {
            isCaseSensitive: false,
            shouldSort: true,
            minMatchCharLength: 2,
            limit: 10,
          };
          var results = fuse.search(query, searchOptions);
          callback(results
            .map(function(result) { return result.item; })
          );
        },
        templates: {
          suggestion: function(suggestion) {
            var img = suggestion.preview && Object.keys(suggestion.preview).length > 0
              ? `<img src="${offsetURL(suggestion.preview)}"</img>`
              : '';
            var html = `
              <div class="search-item">
                <h3>${suggestion.title}</h3>
                <div class="search-item-description">
                  ${suggestion.description || ''}
                </div>
                <div class="search-item-preview">
                  ${img}
                </div>
              </div>
            `;
            return html;
          }
        }
      }]).on('autocomplete:selected', function(event, suggestion) {
        window.location.href = offsetURL(suggestion.path);
      });
      // remove inline display style on autocompleter (we want to
      // manage responsive display via css)
      $('.algolia-autocomplete').css("display", "");
    })
    .catch(function(error) {
      console.log(error);
    });

});

</script>

<style type="text/css">

.nav-search {
  font-size: x-small;
}

/* Algolioa Autocomplete */

.algolia-autocomplete {
  display: inline-block;
  margin-left: 10px;
  vertical-align: sub;
  background-color: white;
  color: black;
  padding: 6px;
  padding-top: 8px;
  padding-bottom: 0;
  border-radius: 6px;
  border: 1px #0F2E3D solid;
  width: 180px;
}


@media screen and (max-width: 768px) {
  .distill-site-nav .algolia-autocomplete {
    display: none;
    visibility: hidden;
  }
  .distill-site-nav.responsive .algolia-autocomplete {
    display: inline-block;
    visibility: visible;
  }
  .distill-site-nav.responsive .algolia-autocomplete .aa-dropdown-menu {
    margin-left: 0;
    width: 400px;
    max-height: 400px;
  }
}

.algolia-autocomplete .aa-input, .algolia-autocomplete .aa-hint {
  width: 90%;
  outline: none;
  border: none;
}

.algolia-autocomplete .aa-hint {
  color: #999;
}
.algolia-autocomplete .aa-dropdown-menu {
  width: 550px;
  max-height: 70vh;
  overflow-x: visible;
  overflow-y: scroll;
  padding: 5px;
  margin-top: 3px;
  margin-left: -150px;
  background-color: #fff;
  border-radius: 5px;
  border: 1px solid #999;
  border-top: none;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion {
  cursor: pointer;
  padding: 5px 4px;
  border-bottom: 1px solid #eee;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion:last-of-type {
  border-bottom: none;
  margin-bottom: 2px;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item {
  overflow: hidden;
  font-size: 0.8em;
  line-height: 1.4em;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item h3 {
  font-size: 1rem;
  margin-block-start: 0;
  margin-block-end: 5px;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-description {
  display: inline-block;
  overflow: hidden;
  height: 2.8em;
  width: 80%;
  margin-right: 4%;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview {
  display: inline-block;
  width: 15%;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview img {
  height: 3em;
  width: auto;
  display: none;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview img[src] {
  display: initial;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion.aa-cursor {
  background-color: #eee;
}
.algolia-autocomplete .aa-dropdown-menu .aa-suggestion em {
  font-weight: bold;
  font-style: normal;
}

</style>


<!--/radix_placeholder_navigation_in_header-->
  <!--radix_placeholder_distill-->

<style type="text/css">

body {
  background-color: white;
}

.pandoc-table {
  width: 100%;
}

.pandoc-table>caption {
  margin-bottom: 10px;
}

.pandoc-table th:not([align]) {
  text-align: left;
}

.pagedtable-footer {
  font-size: 15px;
}

d-byline .byline {
  grid-template-columns: 2fr 2fr;
}

d-byline .byline h3 {
  margin-block-start: 1.5em;
}

d-byline .byline .authors-affiliations h3 {
  margin-block-start: 0.5em;
}

.authors-affiliations .orcid-id {
  width: 16px;
  height:16px;
  margin-left: 4px;
  margin-right: 4px;
  vertical-align: middle;
  padding-bottom: 2px;
}

d-title .dt-tags {
  margin-top: 1em;
  grid-column: text;
}

.dt-tags .dt-tag {
  text-decoration: none;
  display: inline-block;
  color: rgba(0,0,0,0.6);
  padding: 0em 0.4em;
  margin-right: 0.5em;
  margin-bottom: 0.4em;
  font-size: 70%;
  border: 1px solid rgba(0,0,0,0.2);
  border-radius: 3px;
  text-transform: uppercase;
  font-weight: 500;
}

d-article table.gt_table td,
d-article table.gt_table th {
  border-bottom: none;
}

.html-widget {
  margin-bottom: 2.0em;
}

.l-screen-inset {
  padding-right: 16px;
}

.l-screen .caption {
  margin-left: 10px;
}

.shaded {
  background: rgb(247, 247, 247);
  padding-top: 20px;
  padding-bottom: 20px;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.shaded .html-widget {
  margin-bottom: 0;
  border: 1px solid rgba(0, 0, 0, 0.1);
}

.shaded .shaded-content {
  background: white;
}

.text-output {
  margin-top: 0;
  line-height: 1.5em;
}

.hidden {
  display: none !important;
}

d-article {
  padding-top: 2.5rem;
  padding-bottom: 30px;
}

d-appendix {
  padding-top: 30px;
}

d-article>p>img {
  width: 100%;
}

d-article h2 {
  margin: 1rem 0 1.5rem 0;
}

d-article h3 {
  margin-top: 1.5rem;
}

d-article iframe {
  border: 1px solid rgba(0, 0, 0, 0.1);
  margin-bottom: 2.0em;
  width: 100%;
}

/* Tweak code blocks */

d-article div.sourceCode code,
d-article pre code {
  font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
}

d-article pre,
d-article div.sourceCode,
d-article div.sourceCode pre {
  overflow: auto;
}

d-article div.sourceCode {
  background-color: white;
}

d-article div.sourceCode pre {
  padding-left: 10px;
  font-size: 12px;
  border-left: 2px solid rgba(0,0,0,0.1);
}

d-article pre {
  font-size: 12px;
  color: black;
  background: none;
  margin-top: 0;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.5;

  -moz-tab-size: 4;
  -o-tab-size: 4;
  tab-size: 4;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

d-article pre a {
  border-bottom: none;
}

d-article pre a:hover {
  border-bottom: none;
  text-decoration: underline;
}

d-article details {
  grid-column: text;
  margin-bottom: 0.8em;
}

@media(min-width: 768px) {

d-article pre,
d-article div.sourceCode,
d-article div.sourceCode pre {
  overflow: visible !important;
}

d-article div.sourceCode pre {
  padding-left: 18px;
  font-size: 14px;
}

d-article pre {
  font-size: 14px;
}

}

figure img.external {
  background: white;
  border: 1px solid rgba(0, 0, 0, 0.1);
  box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
  padding: 18px;
  box-sizing: border-box;
}

/* CSS for d-contents */

.d-contents {
  grid-column: text;
  color: rgba(0,0,0,0.8);
  font-size: 0.9em;
  padding-bottom: 1em;
  margin-bottom: 1em;
  padding-bottom: 0.5em;
  margin-bottom: 1em;
  padding-left: 0.25em;
  justify-self: start;
}

@media(min-width: 1000px) {
  .d-contents.d-contents-float {
    height: 0;
    grid-column-start: 1;
    grid-column-end: 4;
    justify-self: center;
    padding-right: 3em;
    padding-left: 2em;
  }
}

.d-contents nav h3 {
  font-size: 18px;
  margin-top: 0;
  margin-bottom: 1em;
}

.d-contents li {
  list-style-type: none
}

.d-contents nav > ul {
  padding-left: 0;
}

.d-contents ul {
  padding-left: 1em
}

.d-contents nav ul li {
  margin-top: 0.6em;
  margin-bottom: 0.2em;
}

.d-contents nav a {
  font-size: 13px;
  border-bottom: none;
  text-decoration: none
  color: rgba(0, 0, 0, 0.8);
}

.d-contents nav a:hover {
  text-decoration: underline solid rgba(0, 0, 0, 0.6)
}

.d-contents nav > ul > li > a {
  font-weight: 600;
}

.d-contents nav > ul > li > ul {
  font-weight: inherit;
}

.d-contents nav > ul > li > ul > li {
  margin-top: 0.2em;
}


.d-contents nav ul {
  margin-top: 0;
  margin-bottom: 0.25em;
}

.d-article-with-toc h2:nth-child(2) {
  margin-top: 0;
}


/* Figure */

.figure {
  position: relative;
  margin-bottom: 2.5em;
  margin-top: 1.5em;
}

.figure img {
  width: 100%;
}

.figure .caption {
  color: rgba(0, 0, 0, 0.6);
  font-size: 12px;
  line-height: 1.5em;
}

.figure img.external {
  background: white;
  border: 1px solid rgba(0, 0, 0, 0.1);
  box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
  padding: 18px;
  box-sizing: border-box;
}

.figure .caption a {
  color: rgba(0, 0, 0, 0.6);
}

.figure .caption b,
.figure .caption strong, {
  font-weight: 600;
  color: rgba(0, 0, 0, 1.0);
}

/* Citations */

d-article .citation {
  color: inherit;
  cursor: inherit;
}

div.hanging-indent{
  margin-left: 1em; text-indent: -1em;
}

/* Citation hover box */

.tippy-box[data-theme~=light-border] {
  background-color: rgba(250, 250, 250, 0.95);
}

.tippy-content > p {
  margin-bottom: 0;
  padding: 2px;
}


/* Tweak 1000px media break to show more text */

@media(min-width: 1000px) {
  .base-grid,
  distill-header,
  d-title,
  d-abstract,
  d-article,
  d-appendix,
  distill-appendix,
  d-byline,
  d-footnote-list,
  d-citation-list,
  distill-footer {
    grid-template-columns: [screen-start] 1fr [page-start kicker-start] 80px [middle-start] 50px [text-start kicker-end] 65px 65px 65px 65px 65px 65px 65px 65px [text-end gutter-start] 65px [middle-end] 65px [page-end gutter-end] 1fr [screen-end];
    grid-column-gap: 16px;
  }

  .grid {
    grid-column-gap: 16px;
  }

  d-article {
    font-size: 1.06rem;
    line-height: 1.7em;
  }
  figure .caption, .figure .caption, figure figcaption {
    font-size: 13px;
  }
}

@media(min-width: 1180px) {
  .base-grid,
  distill-header,
  d-title,
  d-abstract,
  d-article,
  d-appendix,
  distill-appendix,
  d-byline,
  d-footnote-list,
  d-citation-list,
  distill-footer {
    grid-template-columns: [screen-start] 1fr [page-start kicker-start] 60px [middle-start] 60px [text-start kicker-end] 60px 60px 60px 60px 60px 60px 60px 60px [text-end gutter-start] 60px [middle-end] 60px [page-end gutter-end] 1fr [screen-end];
    grid-column-gap: 32px;
  }

  .grid {
    grid-column-gap: 32px;
  }
}


/* Get the citation styles for the appendix (not auto-injected on render since
   we do our own rendering of the citation appendix) */

d-appendix .citation-appendix,
.d-appendix .citation-appendix {
  font-size: 11px;
  line-height: 15px;
  border-left: 1px solid rgba(0, 0, 0, 0.1);
  padding-left: 18px;
  border: 1px solid rgba(0,0,0,0.1);
  background: rgba(0, 0, 0, 0.02);
  padding: 10px 18px;
  border-radius: 3px;
  color: rgba(150, 150, 150, 1);
  overflow: hidden;
  margin-top: -12px;
  white-space: pre-wrap;
  word-wrap: break-word;
}

/* Include appendix styles here so they can be overridden */

d-appendix {
  contain: layout style;
  font-size: 0.8em;
  line-height: 1.7em;
  margin-top: 60px;
  margin-bottom: 0;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  color: rgba(0,0,0,0.5);
  padding-top: 60px;
  padding-bottom: 48px;
}

d-appendix h3 {
  grid-column: page-start / text-start;
  font-size: 15px;
  font-weight: 500;
  margin-top: 1em;
  margin-bottom: 0;
  color: rgba(0,0,0,0.65);
}

d-appendix h3 + * {
  margin-top: 1em;
}

d-appendix ol {
  padding: 0 0 0 15px;
}

@media (min-width: 768px) {
  d-appendix ol {
    padding: 0 0 0 30px;
    margin-left: -30px;
  }
}

d-appendix li {
  margin-bottom: 1em;
}

d-appendix a {
  color: rgba(0, 0, 0, 0.6);
}

d-appendix > * {
  grid-column: text;
}

d-appendix > d-footnote-list,
d-appendix > d-citation-list,
d-appendix > distill-appendix {
  grid-column: screen;
}

/* Include footnote styles here so they can be overridden */

d-footnote-list {
  contain: layout style;
}

d-footnote-list > * {
  grid-column: text;
}

d-footnote-list a.footnote-backlink {
  color: rgba(0,0,0,0.3);
  padding-left: 0.5em;
}



/* Anchor.js */

.anchorjs-link {
  /*transition: all .25s linear; */
  text-decoration: none;
  border-bottom: none;
}
*:hover > .anchorjs-link {
  margin-left: -1.125em !important;
  text-decoration: none;
  border-bottom: none;
}

/* Social footer */

.social_footer {
  margin-top: 30px;
  margin-bottom: 0;
  color: rgba(0,0,0,0.67);
}

.disqus-comments {
  margin-right: 30px;
}

.disqus-comment-count {
  border-bottom: 1px solid rgba(0, 0, 0, 0.4);
  cursor: pointer;
}

#disqus_thread {
  margin-top: 30px;
}

.article-sharing a {
  border-bottom: none;
  margin-right: 8px;
}

.article-sharing a:hover {
  border-bottom: none;
}

.sidebar-section.subscribe {
  font-size: 12px;
  line-height: 1.6em;
}

.subscribe p {
  margin-bottom: 0.5em;
}


.article-footer .subscribe {
  font-size: 15px;
  margin-top: 45px;
}


.sidebar-section.custom {
  font-size: 12px;
  line-height: 1.6em;
}

.custom p {
  margin-bottom: 0.5em;
}

/* Styles for listing layout (hide title) */
.layout-listing d-title, .layout-listing .d-title {
  display: none;
}

/* Styles for posts lists (not auto-injected) */


.posts-with-sidebar {
  padding-left: 45px;
  padding-right: 45px;
}

.posts-list .description h2,
.posts-list .description p {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
}

.posts-list .description h2 {
  font-weight: 700;
  border-bottom: none;
  padding-bottom: 0;
}

.posts-list h2.post-tag {
  border-bottom: 1px solid rgba(0, 0, 0, 0.2);
  padding-bottom: 12px;
}
.posts-list {
  margin-top: 60px;
  margin-bottom: 24px;
}

.posts-list .post-preview {
  text-decoration: none;
  overflow: hidden;
  display: block;
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  padding: 24px 0;
}

.post-preview-last {
  border-bottom: none !important;
}

.posts-list .posts-list-caption {
  grid-column: screen;
  font-weight: 400;
}

.posts-list .post-preview h2 {
  margin: 0 0 6px 0;
  line-height: 1.2em;
  font-style: normal;
  font-size: 24px;
}

.posts-list .post-preview p {
  margin: 0 0 12px 0;
  line-height: 1.4em;
  font-size: 16px;
}

.posts-list .post-preview .thumbnail {
  box-sizing: border-box;
  margin-bottom: 24px;
  position: relative;
  max-width: 500px;
}
.posts-list .post-preview img {
  width: 100%;
  display: block;
}

.posts-list .metadata {
  font-size: 12px;
  line-height: 1.4em;
  margin-bottom: 18px;
}

.posts-list .metadata > * {
  display: inline-block;
}

.posts-list .metadata .publishedDate {
  margin-right: 2em;
}

.posts-list .metadata .dt-authors {
  display: block;
  margin-top: 0.3em;
  margin-right: 2em;
}

.posts-list .dt-tags {
  display: block;
  line-height: 1em;
}

.posts-list .dt-tags .dt-tag {
  display: inline-block;
  color: rgba(0,0,0,0.6);
  padding: 0.3em 0.4em;
  margin-right: 0.2em;
  margin-bottom: 0.4em;
  font-size: 60%;
  border: 1px solid rgba(0,0,0,0.2);
  border-radius: 3px;
  text-transform: uppercase;
  font-weight: 500;
}

.posts-list img {
  opacity: 1;
}

.posts-list img[data-src] {
  opacity: 0;
}

.posts-more {
  clear: both;
}


.posts-sidebar {
  font-size: 16px;
}

.posts-sidebar h3 {
  font-size: 16px;
  margin-top: 0;
  margin-bottom: 0.5em;
  font-weight: 400;
  text-transform: uppercase;
}

.sidebar-section {
  margin-bottom: 30px;
}

.categories ul {
  list-style-type: none;
  margin: 0;
  padding: 0;
}

.categories li {
  color: rgba(0, 0, 0, 0.8);
  margin-bottom: 0;
}

.categories li>a {
  border-bottom: none;
}

.categories li>a:hover {
  border-bottom: 1px solid rgba(0, 0, 0, 0.4);
}

.categories .active {
  font-weight: 600;
}

.categories .category-count {
  color: rgba(0, 0, 0, 0.4);
}


@media(min-width: 768px) {
  .posts-list .post-preview h2 {
    font-size: 26px;
  }
  .posts-list .post-preview .thumbnail {
    float: right;
    width: 30%;
    margin-bottom: 0;
  }
  .posts-list .post-preview .description {
    float: left;
    width: 45%;
  }
  .posts-list .post-preview .metadata {
    float: left;
    width: 20%;
    margin-top: 8px;
  }
  .posts-list .post-preview p {
    margin: 0 0 12px 0;
    line-height: 1.5em;
    font-size: 16px;
  }
  .posts-with-sidebar .posts-list {
    float: left;
    width: 75%;
  }
  .posts-with-sidebar .posts-sidebar {
    float: right;
    width: 20%;
    margin-top: 60px;
    padding-top: 24px;
    padding-bottom: 24px;
  }
}


/* Improve display for browsers without grid (IE/Edge <= 15) */

.downlevel {
  line-height: 1.6em;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  margin: 0;
}

.downlevel .d-title {
  padding-top: 6rem;
  padding-bottom: 1.5rem;
}

.downlevel .d-title h1 {
  font-size: 50px;
  font-weight: 700;
  line-height: 1.1em;
  margin: 0 0 0.5rem;
}

.downlevel .d-title p {
  font-weight: 300;
  font-size: 1.2rem;
  line-height: 1.55em;
  margin-top: 0;
}

.downlevel .d-byline {
  padding-top: 0.8em;
  padding-bottom: 0.8em;
  font-size: 0.8rem;
  line-height: 1.8em;
}

.downlevel .section-separator {
  border: none;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
}

.downlevel .d-article {
  font-size: 1.06rem;
  line-height: 1.7em;
  padding-top: 1rem;
  padding-bottom: 2rem;
}


.downlevel .d-appendix {
  padding-left: 0;
  padding-right: 0;
  max-width: none;
  font-size: 0.8em;
  line-height: 1.7em;
  margin-bottom: 0;
  color: rgba(0,0,0,0.5);
  padding-top: 40px;
  padding-bottom: 48px;
}

.downlevel .footnotes ol {
  padding-left: 13px;
}

.downlevel .base-grid,
.downlevel .distill-header,
.downlevel .d-title,
.downlevel .d-abstract,
.downlevel .d-article,
.downlevel .d-appendix,
.downlevel .distill-appendix,
.downlevel .d-byline,
.downlevel .d-footnote-list,
.downlevel .d-citation-list,
.downlevel .distill-footer,
.downlevel .appendix-bottom,
.downlevel .posts-container {
  padding-left: 40px;
  padding-right: 40px;
}

@media(min-width: 768px) {
  .downlevel .base-grid,
  .downlevel .distill-header,
  .downlevel .d-title,
  .downlevel .d-abstract,
  .downlevel .d-article,
  .downlevel .d-appendix,
  .downlevel .distill-appendix,
  .downlevel .d-byline,
  .downlevel .d-footnote-list,
  .downlevel .d-citation-list,
  .downlevel .distill-footer,
  .downlevel .appendix-bottom,
  .downlevel .posts-container {
  padding-left: 150px;
  padding-right: 150px;
  max-width: 900px;
}
}

.downlevel pre code {
  display: block;
  border-left: 2px solid rgba(0, 0, 0, .1);
  padding: 0 0 0 20px;
  font-size: 14px;
}

.downlevel code, .downlevel pre {
  color: black;
  background: none;
  font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.5;

  -moz-tab-size: 4;
  -o-tab-size: 4;
  tab-size: 4;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

.downlevel .posts-list .post-preview {
  color: inherit;
}



</style>

<script type="application/javascript">

function is_downlevel_browser() {
  if (bowser.isUnsupportedBrowser({ msie: "12", msedge: "16"},
                                 window.navigator.userAgent)) {
    return true;
  } else {
    return window.load_distill_framework === undefined;
  }
}

// show body when load is complete
function on_load_complete() {

  // add anchors
  if (window.anchors) {
    window.anchors.options.placement = 'left';
    window.anchors.add('d-article > h2, d-article > h3, d-article > h4, d-article > h5');
  }


  // set body to visible
  document.body.style.visibility = 'visible';

  // force redraw for leaflet widgets
  if (window.HTMLWidgets) {
    var maps = window.HTMLWidgets.findAll(".leaflet");
    $.each(maps, function(i, el) {
      var map = this.getMap();
      map.invalidateSize();
      map.eachLayer(function(layer) {
        if (layer instanceof L.TileLayer)
          layer.redraw();
      });
    });
  }

  // trigger 'shown' so htmlwidgets resize
  $('d-article').trigger('shown');
}

function init_distill() {

  init_common();

  // create front matter
  var front_matter = $('<d-front-matter></d-front-matter>');
  $('#distill-front-matter').wrap(front_matter);

  // create d-title
  $('.d-title').changeElementType('d-title');

  // create d-byline
  var byline = $('<d-byline></d-byline>');
  $('.d-byline').replaceWith(byline);

  // create d-article
  var article = $('<d-article></d-article>');
  $('.d-article').wrap(article).children().unwrap();

  // move posts container into article
  $('.posts-container').appendTo($('d-article'));

  // create d-appendix
  $('.d-appendix').changeElementType('d-appendix');

  // flag indicating that we have appendix items
  var appendix = $('.appendix-bottom').children('h3').length > 0;

  // replace footnotes with <d-footnote>
  $('.footnote-ref').each(function(i, val) {
    appendix = true;
    var href = $(this).attr('href');
    var id = href.replace('#', '');
    var fn = $('#' + id);
    var fn_p = $('#' + id + '>p');
    fn_p.find('.footnote-back').remove();
    var text = fn_p.html();
    var dtfn = $('<d-footnote></d-footnote>');
    dtfn.html(text);
    $(this).replaceWith(dtfn);
  });
  // remove footnotes
  $('.footnotes').remove();

  // move refs into #references-listing
  $('#references-listing').replaceWith($('#refs'));

  $('h1.appendix, h2.appendix').each(function(i, val) {
    $(this).changeElementType('h3');
  });
  $('h3.appendix').each(function(i, val) {
    var id = $(this).attr('id');
    $('.d-contents a[href="#' + id + '"]').parent().remove();
    appendix = true;
    $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('d-appendix'));
  });

  // show d-appendix if we have appendix content
  $("d-appendix").css('display', appendix ? 'grid' : 'none');

  // localize layout chunks to just output
  $('.layout-chunk').each(function(i, val) {

    // capture layout
    var layout = $(this).attr('data-layout');

    // apply layout to markdown level block elements
    var elements = $(this).children().not('details, div.sourceCode, pre, script');
    elements.each(function(i, el) {
      var layout_div = $('<div class="' + layout + '"></div>');
      if (layout_div.hasClass('shaded')) {
        var shaded_content = $('<div class="shaded-content"></div>');
        $(this).wrap(shaded_content);
        $(this).parent().wrap(layout_div);
      } else {
        $(this).wrap(layout_div);
      }
    });


    // unwrap the layout-chunk div
    $(this).children().unwrap();
  });

  // remove code block used to force  highlighting css
  $('.distill-force-highlighting-css').parent().remove();

  // remove empty line numbers inserted by pandoc when using a
  // custom syntax highlighting theme
  $('code.sourceCode a:empty').remove();

  // load distill framework
  load_distill_framework();

  // wait for window.distillRunlevel == 4 to do post processing
  function distill_post_process() {

    if (!window.distillRunlevel || window.distillRunlevel < 4)
      return;

    // hide author/affiliations entirely if we have no authors
    var front_matter = JSON.parse($("#distill-front-matter").html());
    var have_authors = front_matter.authors && front_matter.authors.length > 0;
    if (!have_authors)
      $('d-byline').addClass('hidden');

    // article with toc class
    $('.d-contents').parent().addClass('d-article-with-toc');

    // strip links that point to #
    $('.authors-affiliations').find('a[href="#"]').removeAttr('href');

    // add orcid ids
    $('.authors-affiliations').find('.author').each(function(i, el) {
      var orcid_id = front_matter.authors[i].orcidID;
      if (orcid_id) {
        var a = $('<a></a>');
        a.attr('href', 'https://orcid.org/' + orcid_id);
        var img = $('<img></img>');
        img.addClass('orcid-id');
        img.attr('alt', 'ORCID ID');
        img.attr('src','data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg==');
        a.append(img);
        $(this).append(a);
      }
    });

    // hide elements of author/affiliations grid that have no value
    function hide_byline_column(caption) {
      $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'hidden');
    }

    // affiliations
    var have_affiliations = false;
    for (var i = 0; i<front_matter.authors.length; ++i) {
      var author = front_matter.authors[i];
      if (author.affiliation !== "&nbsp;") {
        have_affiliations = true;
        break;
      }
    }
    if (!have_affiliations)
      $('d-byline').find('h3:contains("Affiliations")').css('visibility', 'hidden');

    // published date
    if (!front_matter.publishedDate)
      hide_byline_column("Published");

    // document object identifier
    var doi = $('d-byline').find('h3:contains("DOI")');
    var doi_p = doi.next().empty();
    if (!front_matter.doi) {
      // if we have a citation and valid citationText then link to that
      if ($('#citation').length > 0 && front_matter.citationText) {
        doi.html('Citation');
        $('<a href="#citation"></a>')
          .text(front_matter.citationText)
          .appendTo(doi_p);
      } else {
        hide_byline_column("DOI");
      }
    } else {
      $('<a></a>')
         .attr('href', "https://doi.org/" + front_matter.doi)
         .html(front_matter.doi)
         .appendTo(doi_p);
    }

     // change plural form of authors/affiliations
    if (front_matter.authors.length === 1) {
      var grid = $('.authors-affiliations');
      grid.children('h3:contains("Authors")').text('Author');
      grid.children('h3:contains("Affiliations")').text('Affiliation');
    }

    // remove d-appendix and d-footnote-list local styles
    $('d-appendix > style:first-child').remove();
    $('d-footnote-list > style:first-child').remove();

    // move appendix-bottom entries to the bottom
    $('.appendix-bottom').appendTo('d-appendix').children().unwrap();
    $('.appendix-bottom').remove();

    // hoverable references
    $('span.citation[data-cites]').each(function() {
      var refHtml = $('#ref-' + $(this).attr('data-cites')).html();
      window.tippy(this, {
        allowHTML: true,
        content: refHtml,
        maxWidth: 500,
        interactive: true,
        interactiveBorder: 10,
        theme: 'light-border',
        placement: 'bottom-start'
      });
    });

    // clear polling timer
    clearInterval(tid);

    // show body now that everything is ready
    on_load_complete();
  }

  var tid = setInterval(distill_post_process, 50);
  distill_post_process();

}

function init_downlevel() {

  init_common();

   // insert hr after d-title
  $('.d-title').after($('<hr class="section-separator"/>'));

  // check if we have authors
  var front_matter = JSON.parse($("#distill-front-matter").html());
  var have_authors = front_matter.authors && front_matter.authors.length > 0;

  // manage byline/border
  if (!have_authors)
    $('.d-byline').remove();
  $('.d-byline').after($('<hr class="section-separator"/>'));
  $('.d-byline a').remove();

  // remove toc
  $('.d-contents').remove();

  // move appendix elements
  $('h1.appendix, h2.appendix').each(function(i, val) {
    $(this).changeElementType('h3');
  });
  $('h3.appendix').each(function(i, val) {
    $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('.d-appendix'));
  });


  // inject headers into references and footnotes
  var refs_header = $('<h3></h3>');
  refs_header.text('References');
  $('#refs').prepend(refs_header);

  var footnotes_header = $('<h3></h3');
  footnotes_header.text('Footnotes');
  $('.footnotes').children('hr').first().replaceWith(footnotes_header);

  // move appendix-bottom entries to the bottom
  $('.appendix-bottom').appendTo('.d-appendix').children().unwrap();
  $('.appendix-bottom').remove();

  // remove appendix if it's empty
  if ($('.d-appendix').children().length === 0)
    $('.d-appendix').remove();

  // prepend separator above appendix
  $('.d-appendix').before($('<hr class="section-separator" style="clear: both"/>'));

  // trim code
  $('pre>code').each(function(i, val) {
    $(this).html($.trim($(this).html()));
  });

  // move posts-container right before article
  $('.posts-container').insertBefore($('.d-article'));

  $('body').addClass('downlevel');

  on_load_complete();
}


function init_common() {

  // jquery plugin to change element types
  (function($) {
    $.fn.changeElementType = function(newType) {
      var attrs = {};

      $.each(this[0].attributes, function(idx, attr) {
        attrs[attr.nodeName] = attr.nodeValue;
      });

      this.replaceWith(function() {
        return $("<" + newType + "/>", attrs).append($(this).contents());
      });
    };
  })(jQuery);

  // prevent underline for linked images
  $('a > img').parent().css({'border-bottom' : 'none'});

  // mark non-body figures created by knitr chunks as 100% width
  $('.layout-chunk').each(function(i, val) {
    var figures = $(this).find('img, .html-widget');
    if ($(this).attr('data-layout') !== "l-body") {
      figures.css('width', '100%');
    } else {
      figures.css('max-width', '100%');
      figures.filter("[width]").each(function(i, val) {
        var fig = $(this);
        fig.css('width', fig.attr('width') + 'px');
      });

    }
  });

  // auto-append index.html to post-preview links in file: protocol
  // and in rstudio ide preview
  $('.post-preview').each(function(i, val) {
    if (window.location.protocol === "file:")
      $(this).attr('href', $(this).attr('href') + "index.html");
  });

  // get rid of index.html references in header
  if (window.location.protocol !== "file:") {
    $('.distill-site-header a[href]').each(function(i,val) {
      $(this).attr('href', $(this).attr('href').replace("index.html", "./"));
    });
  }

  // add class to pandoc style tables
  $('tr.header').parent('thead').parent('table').addClass('pandoc-table');
  $('.kable-table').children('table').addClass('pandoc-table');

  // add figcaption style to table captions
  $('caption').parent('table').addClass("figcaption");

  // initialize posts list
  if (window.init_posts_list)
    window.init_posts_list();

  // implmement disqus comment link
  $('.disqus-comment-count').click(function() {
    window.headroom_prevent_pin = true;
    $('#disqus_thread').toggleClass('hidden');
    if (!$('#disqus_thread').hasClass('hidden')) {
      var offset = $(this).offset();
      $(window).resize();
      $('html, body').animate({
        scrollTop: offset.top - 35
      });
    }
  });
}

document.addEventListener('DOMContentLoaded', function() {
  if (is_downlevel_browser())
    init_downlevel();
  else
    window.addEventListener('WebComponentsReady', init_distill);
});

</script>

<style type="text/css">
/* base variables */

/* Edit the CSS properties in this file to create a custom
   Distill theme. Only edit values in the right column
   for each row; values shown are the CSS defaults.
   To return any property to the default,
   you may set its value to: unset
   All rows must end with a semi-colon.                      */

/* Optional: embed custom fonts here with `@import`          */
/* This must remain at the top of this file.                 */



html {
  /*-- Main font sizes --*/
  --title-size:      50px;
  --body-size:       1.06rem;
  --code-size:       14px;
  --aside-size:      12px;
  --fig-cap-size:    13px;
  /*-- Main font colors --*/
  --title-color:     #000000;
  --header-color:    rgba(0, 0, 0, 0.8);
  --body-color:      rgba(0, 0, 0, 0.8);
  --aside-color:     rgba(0, 0, 0, 0.6);
  --fig-cap-color:   rgba(0, 0, 0, 0.6);
  /*-- Specify custom fonts ~~~ must be imported above   --*/
  --heading-font:    sans-serif;
  --mono-font:       monospace;
  --body-font:       sans-serif;
  --navbar-font:     sans-serif;  /* websites + blogs only */
}

/*-- ARTICLE METADATA --*/
d-byline {
  --heading-size:    0.6rem;
  --heading-color:   rgba(0, 0, 0, 0.5);
  --body-size:       0.8rem;
  --body-color:      rgba(0, 0, 0, 0.8);
}

/*-- ARTICLE TABLE OF CONTENTS --*/
.d-contents {
  --heading-size:    18px;
  --contents-size:   13px;
}

/*-- ARTICLE APPENDIX --*/
d-appendix {
  --heading-size:    15px;
  --heading-color:   rgba(0, 0, 0, 0.65);
  --text-size:       0.8em;
  --text-color:      rgba(0, 0, 0, 0.5);
}

/*-- WEBSITE HEADER + FOOTER --*/
/* These properties only apply to Distill sites and blogs  */

.distill-site-header {
  --title-size:       18px;
  --text-color:       rgba(255, 255, 255, 0.8);
  --text-size:        15px;
  --hover-color:      white;
  --bkgd-color:       #0F2E3D;
}

.distill-site-footer {
  --text-color:       rgba(255, 255, 255, 0.8);
  --text-size:        15px;
  --hover-color:      white;
  --bkgd-color:       #0F2E3D;
}

/*-- Additional custom styles --*/
/* Add any additional CSS rules below                      */
</style>
<style type="text/css">
/* base variables */

/* Edit the CSS properties in this file to create a custom
   Distill theme. Only edit values in the right column
   for each row; values shown are the CSS defaults.
   To return any property to the default,
   you may set its value to: unset
   All rows must end with a semi-colon.                      */

/* Optional: embed custom fonts here with `@import`          */
/* This must remain at the top of this file.                 */
@import url('https://fonts.googleapis.com/css2?family=Lato');
@import url('https://fonts.googleapis.com/css2?family=Chivo');
@import url('https://fonts.googleapis.com/css2?family=Fira+Mono');



html {
  /*-- Main font sizes --*/
  --title-size:      50px;
  --body-size:       1.06rem;
  --code-size:       14px;
  --aside-size:      12px;
  --fig-cap-size:    13px;
  /*-- Main font colors --*/
  --title-color:     #000000;
  --header-color:    rgba(0, 0, 0, 0.8);
  --body-color:      rgba(0, 0, 0, 0.8);
  --aside-color:     rgba(0, 0, 0, 0.6);
  --fig-cap-color:   rgba(0, 0, 0, 0.6);
  /*-- Specify custom fonts ~~~ must be imported above   --*/
  --heading-font:    'Fira Mono', sans-serif;
  --mono-font:       'Fira Mono', monospace;
  --body-font:       'Lato', sans-serif;
  --navbar-font:     "Fira Mono", serif;
}

/*-- ARTICLE METADATA --*/
.d-byline {
  --heading-size:    0.6rem;
  --heading-color:   rgba(0, 0, 0, 0.5);
  --body-size:       0.8rem;
  --body-color:      rgba(0, 0, 0, 0.8);
}

/*-- ARTICLE TABLE OF CONTENTS --*/
.d-contents {
  --heading-size:    18px;
  --contents-size:   13px;
}

/*-- ARTICLE APPENDIX --*/
d-appendix {
  --heading-size:    15px;
  --heading-color:   rgba(0, 0, 0, 0.65);
  --text-size:       0.8em;
  --text-color:      rgba(0, 0, 0, 0.5);
}

/*-- WEBSITE HEADER + FOOTER --*/
/* These properties only apply to Distill sites and blogs  */

.distill-site-header {
  --title-size:       18px;
  --text-color:       #000;
  --text-size:        15px;
  --hover-color:      #ff6700;
  --bkgd-color:       white;
}

.distill-site-footer {
  --text-color:       #000;
  --text-size:        15px;
  --hover-color:      #ff6700;
  --bkgd-color:       white;
}</style>
<style type="text/css">
/* base style */

/* FONT FAMILIES */

:root {
  --heading-default: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  --mono-default: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  --body-default: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
}

body,
.posts-list .post-preview p,
.posts-list .description p {
  font-family: var(--body-font), var(--body-default);
}

h1, h2, h3, h4, h5, h6,
.posts-list .post-preview h2,
.posts-list .description h2 {
  font-family: var(--heading-font), var(--heading-default);
}

d-article div.sourceCode code,
d-article pre code {
  font-family: var(--mono-font), var(--mono-default);
}


/*-- TITLE --*/
d-title h1,
.posts-list > h1 {
  color: var(--title-color, black);
}

d-title h1 {
  font-size: var(--title-size, 50px);
}

/*-- HEADERS --*/
d-article h1,
d-article h2,
d-article h3,
d-article h4,
d-article h5,
d-article h6 {
  color: var(--header-color, rgba(0, 0, 0, 0.8));
}

/*-- BODY --*/
d-article > p,  /* only text inside of <p> tags */
d-article > ul, /* lists */
d-article > ol {
  color: var(--body-color, rgba(0, 0, 0, 0.8));
  font-size: var(--body-size, 1.06rem);
}


/*-- CODE --*/
d-article div.sourceCode code,
d-article pre code {
  font-size: var(--code-size, 14px);
}

/*-- ASIDE --*/
d-article aside {
  font-size: var(--aside-size, 12px);
  color: var(--aside-color, rgba(0, 0, 0, 0.6));
}

/*-- FIGURE CAPTIONS --*/
figure .caption,
figure figcaption,
.figure .caption {
  font-size: var(--fig-cap-size, 13px);
  color: var(--fig-cap-color, rgba(0, 0, 0, 0.6));
}

/*-- METADATA --*/
d-byline h3 {
  font-size: var(--heading-size, 0.6rem);
  color: var(--heading-color, rgba(0, 0, 0, 0.5));
}

d-byline {
  font-size: var(--body-size, 0.8rem);
  color: var(--body-color, rgba(0, 0, 0, 0.8));
}

d-byline a,
d-article d-byline a {
  color: var(--body-color, rgba(0, 0, 0, 0.8));
}

/*-- TABLE OF CONTENTS --*/
.d-contents nav h3 {
  font-size: var(--heading-size, 18px);
}

.d-contents nav a {
  font-size: var(--contents-size, 13px);
}

/*-- APPENDIX --*/
d-appendix h3 {
  font-size: var(--heading-size, 15px);
  color: var(--heading-color, rgba(0, 0, 0, 0.65));
}

d-appendix {
  font-size: var(--text-size, 0.8em);
  color: var(--text-color, rgba(0, 0, 0, 0.5));
}

d-appendix d-footnote-list a.footnote-backlink {
  color: var(--text-color, rgba(0, 0, 0, 0.5));
}

/*-- WEBSITE HEADER + FOOTER --*/
.distill-site-header .title {
  font-size: var(--title-size, 18px);
  font-family: var(--navbar-font), var(--heading-default);
}

.distill-site-header a,
.nav-dropdown .nav-dropbtn {
  font-family: var(--navbar-font), var(--heading-default);
}

.nav-dropdown .nav-dropbtn {
  color: var(--text-color, rgba(255, 255, 255, 0.8));
  font-size: var(--text-size, 15px);
}

.distill-site-header a:hover,
.nav-dropdown:hover .nav-dropbtn {
  color: var(--hover-color, white);
}

.distill-site-header {
  font-size: var(--text-size, 15px);
  color: var(--text-color, rgba(255, 255, 255, 0.8));
  background-color: var(--bkgd-color, #0F2E3D);
}

.distill-site-footer {
  font-size: var(--text-size, 15px);
  color: var(--text-color, rgba(255, 255, 255, 0.8));
  background-color: var(--bkgd-color, #0F2E3D);
}

.distill-site-footer a:hover {
  color: var(--hover-color, white);
}</style>
<!--/radix_placeholder_distill-->
  <script src="../../site_libs/header-attrs-2.7.0/header-attrs.js"></script>
  <script src="../../site_libs/jquery-1.11.3/jquery.min.js"></script>
  <script src="../../site_libs/anchor-4.2.2/anchor.min.js"></script>
  <script src="../../site_libs/bowser-1.9.3/bowser.min.js"></script>
  <script src="../../site_libs/webcomponents-2.0.0/webcomponents.js"></script>
  <script src="../../site_libs/distill-2.2.21/template.v2.js"></script>
  <!--radix_placeholder_site_in_header-->
<script>
  document.addEventListener("DOMContentLoaded", function () {
    if (!/posts/.test(location.pathname)) {
      return;
    }

    var script = document.createElement("script");
    script.src = "https://utteranc.es/client.js";
    script.setAttribute("repo", "jthomasmock/radix_themockup");
    script.setAttribute("issue-term", "og:title");
    script.setAttribute("crossorigin", "anonymous");
    script.setAttribute("label", "comment_thread");

    /* wait for article to load, append script to article element */
    var observer = new MutationObserver(function (mutations, observer) {
      var article = document.querySelector("d-article");
      if (article) {
        observer.disconnect();
        /* HACK: article scroll */
        article.setAttribute("style", "overflow-y: hidden");
        article.appendChild(script);
      }
    });

    observer.observe(document.body, { childList: true });
  });
</script>
<script type="text/javascript" cookie-consent="tracking" async src="https://www.googletagmanager.com/gtag/js?id=UA-166026965-1"></script>
<script type="text/javascript" cookie-consent="tracking">
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-166026965-1');
</script>
<!--/radix_placeholder_site_in_header-->


</head>

<body>

<!--radix_placeholder_front_matter-->

<script id="distill-front-matter" type="text/json">
{"title":"Reading tables from images with magick","description":"magick is an R package for manipulating images in R","authors":[{"author":"Thomas Mock","authorURL":"https://twitter.com/thomas_mock","affiliation":"&nbsp;","affiliationURL":"#","orcidID":""}],"publishedDate":"2021-01-18T00:00:00.000+00:00","citationText":"Mock, 2021"}
</script>

<!--/radix_placeholder_front_matter-->
<!--radix_placeholder_navigation_before_body-->
<header class="header header--fixed" role="banner">
<nav class="distill-site-nav distill-site-header">
<div class="nav-left">
<a href="../../index.html" class="title">The Mockup Blog</a>
<input id="distill-search" class="nav-search hidden" type="text" placeholder="Search..."/>
</div>
<div class="nav-right">
<a href="../../index.html">Home</a>
<a href="../../resources.html">Resources</a>
<a href="../../about.html">About</a>
<a href="../../subscribe.html">Subscribe</a>
<a href="https://twitter.com/thomas_mock">
<i class="fa fa-twitter" aria-hidden="true"></i>
</a>
<a href="https://github.com/jthomasmock">
<i class="fa fa-github" aria-hidden="true"></i>
</a>
<a href="../../index.xml">
<i class="fa fa-rss" aria-hidden="true"></i>
</a>
<a href="javascript:void(0);" class="nav-toggle">&#9776;</a>
</div>
</nav>
</header>
<!--/radix_placeholder_navigation_before_body-->
<!--radix_placeholder_site_before_body-->
<!--/radix_placeholder_site_before_body-->

<div class="d-title">
<h1>Reading tables from images with magick</h1>
<!--radix_placeholder_categories-->
<div class="dt-tags">
  <a href="../../index.html#category:magick" class="dt-tag">magick</a>
  <a href="../../index.html#category:web_scraping" class="dt-tag">web scraping</a>
</div>
<!--/radix_placeholder_categories-->
<p><p>magick is an R package for manipulating images in R</p></p>
</div>

<div class="d-byline">
  Thomas Mock <a href="https://twitter.com/thomas_mock" class="uri">https://twitter.com/thomas_mock</a> 
  
<br/>01-18-2021
</div>

<div class="d-article">
<div class="d-contents d-contents-float">
<nav class="l-text toc figcaption" id="TOC">
<h3>Contents</h3>
<ul>
<li><a href="#imagemagick">ImageMagick</a></li>
<li><a href="#the-problem">The problem</a></li>
<li><a href="#excel-screenshot">Excel Screenshot</a>
<ul>
<li><a href="#remove-the-background-and-grid">Remove the background and grid</a></li>
<li><a href="#crop-the-image">Crop the image</a></li>
<li><a href="#try-ocr">Try OCR</a></li>
<li><a href="#make-a-tibble">Make a Tibble</a></li>
<li><a href="#tidy-the-tibble">Tidy the Tibble</a></li>
<li><a href="#write-it-as-a-function">Write it as a Function</a></li>
</ul></li>
<li><a href="#example-2">Example 2</a>
<ul>
<li><a href="#get-the-raw-img">Get the raw img</a></li>
<li><a href="#clean-it-up">Clean it up</a></li>
<li><a href="#crop-the-image-1">Crop the image</a></li>
<li><a href="#try-ocr-1">Try OCR</a></li>
<li><a href="#create-a-function">Create a function</a></li>
<li><a href="#apply-the-function">Apply the function</a></li>
<li><a href="#clean-it-up-1">Clean it up</a></li>
</ul></li>
</ul>
</nav>
</div>
<h1 id="imagemagick">ImageMagick</h1>
<p><a href="https://imagemagick.org/index.php">ImageMagick</a> is a robust and comprehensive open-source image processing library, and per the official <a href="https://imagemagick.org/index.php">docs</a>:</p>
<blockquote>
<p>Use ImageMagick® to create, edit, compose, or convert bitmap images. It can read and write images in a variety of formats (over 200) including PNG, JPEG, GIF, HEIC, TIFF, DPX, EXR, WebP, Postscript, PDF, and SVG. ImageMagick can resize, flip, mirror, rotate, distort, shear and transform images, adjust image colors, apply various special effects, or draw text, lines, polygons, ellipses and Bézier curves.</p>
</blockquote>
<p>While you can use it from various APIs, tools or CLIs, one of the easiest ways for R users to get started is with the R wrapper by ROpenSci’s Jeroen Ooms called <a href="https://docs.ropensci.org/magick/index.html"><code>magick</code></a>. This package provides a large set of pipe-friendly functions allowing for interactive editing and testing.</p>
<p>I’ve written briefly about <code>magick</code> before, specifically in using it to <a href="https://themockup.blog/posts/2019-01-09-add-a-logo-to-your-plot/">add logos to final <code>ggplot2</code> images</a>, but today will be a different use-case, namely using <code>magick</code> to read data embedded in images.</p>
<p>Another note is that while the docs for <code>ImageMagick</code> proper and the <code>magick</code> R wrapper are very good, <code>ImageMagick</code> is an entire piece of software. This means that there is an amazing breadth of applications, knowledge, and tricks to apply. I think of it a lot like <code>regex</code>, where it’s very useful but for many applications we only scratch the surface. For a nice “cookbook” for using <code>ImageMagick</code>, check out this <a href="great%20resource:%20https://legacy.imagemagick.org/Usage/">resource</a>. It’s a “legacy” guide, but many of the examples can be converted to <code>magick</code> in R or from the CLI itself.</p>
<h1 id="the-problem">The problem</h1>
<p>There are many times where someone shares data as an image, whether intentionally due to software constraints (ie Twitter) or as a result of not understanding the implications (image inside a PDF or in a Word Doc). <a href="https://xkcd.com/2116/">xkcd.com</a> jokingly refers to this as <code>.norm</code> or as the Normal File Format. While it’s far from ideal or a <em>real</em> file format, it’s all too common to see data as images in the “wild”. I’ll be using some examples from Twitter images and extracting the raw data from these. There are multiple levels of difficulty, namely that screenshots on Twitter are not uniform, often of relatively low quality (ie DPI), and contain additional “decoration” like colors or grid-lines. We’ll do our best to make it work!</p>
<aside>
<div class="layout-chunk" data-layout="l-body">
<div class="figure"><span id="fig:unnamed-chunk-1"></span>
<img src="norm_normal_file_format.png" alt="https://xkcd.com/2116/" width="152" />
<p class="caption">
Figure 1: <a href="https://xkcd.com/2116/" class="uri">https://xkcd.com/2116/</a>
</p>
</div>
</div>
</aside>
<p>Example one is from Seth Walder, who was kind enough to share the raw data for ESPN’s “Sacks created” stat. Given that it was a quality image, and there were 3 of them, I wanted to try OCR (optical character recognition)!</p>
<blockquote class="twitter-tweet">
<p lang="en" dir="ltr">
OK here's the top 46 players – everyone with at least 5.5 sacks created.<br><br>Sacks created is an ESPN stat using NFL Next Gen Stats data. <a href="https://t.co/cNL23Dna9h">pic.twitter.com/cNL23Dna9h</a>
</p>
— Seth Walder (<span class="citation" data-cites="SethWalder">@SethWalder</span>) <a href="https://twitter.com/SethWalder/status/1349785021922631682?ref_src=twsrc%5Etfw">January 14, 2021</a>
</blockquote>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
<h1 id="excel-screenshot">Excel Screenshot</h1>
<p>So let’s get after it! We’ll need two packages, but I’ll also load <code>tidyverse</code> for the eventual analysis/plotting as well. Also, note that I adapted this from a <a href="code%20adapted%20from:%20https://stackoverflow.com/questions/54000691/extracting-tables-from-jpeg-into-a-dataframe-in-r">StackOverflow post</a> talking about extracting tables from images.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='http://tidyverse.tidyverse.org'>tidyverse</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://docs.ropensci.org/magick/'>magick</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://docs.ropensci.org/tesseract'>tesseract</a></span><span class='op'>)</span>

<span class='va'>sack_url</span> <span class='op'>&lt;-</span> <span class='st'>"https://pbs.twimg.com/media/ErtmQ1PXYAEUQoY?format=jpg&amp;name=900x900"</span>
<span class='va'>raw_img</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://docs.ropensci.org/magick/reference/editing.html'>image_read</a></span><span class='op'>(</span><span class='va'>sack_url</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>Now, while interactively you can just “print” the <code>magick</code> object and it will show up in the viewer pane, for this blog-post I’ll need to explicitly “show” it. I’ll call <code>magick::image_ggplot(&lt;img object&gt;)</code> to print it throughout the post.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='fu'><a href='https://docs.ropensci.org/magick/reference/image_ggplot.html'>image_ggplot</a></span><span class='op'>(</span><span class='va'>raw_img</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="reading-tables-from-images-with-magick_files/figure-html5/unnamed-chunk-3-1.png" width="624" /></p>
</div>
<p>This looks like a relatively clean image, the only major problems being that it’s relatively low-DPI, it has some symbols (team logos), and it has alternating colors along with gridlines (which can mess with the OCR). We can try a “naive” OCR as seen below.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>raw_img</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://docs.ropensci.org/magick/reference/transform.html'>image_crop</a></span><span class='op'>(</span><span class='fu'><a href='https://docs.ropensci.org/magick/reference/geometry.html'>geometry_area</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>0</span>, <span class='fl'>110</span>, <span class='fl'>45</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://docs.ropensci.org/magick/reference/ocr.html'>ocr</a></span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] &quot;Aaron Donald (DE - LA) 19.0,\nMyles Garrett (DE - CLE) 16.5\nTJ. Watt (OLB - PIT) 14.5\nKhalil Mack (OLB - CHI) 13.0\nJustin Houston (DE - IND) 12.0\nEmmanuel Ogbah (DE - MIA) 11.0\nCarl Lawson (DE - CIN) 10.5\nBrandon Graham (DE - PHI) 10.0\nDeMarcus Lawrence (DE - DAL) 10.0\nYannick Ngakoue (DE - BAL) 10.0,\nMontez Sweat (DE - WAS) 10.0\nCarlos’ Dunlap (DE - SEA) 9.0\nCameron Jordan (DE - NO) 9.0\nKerry Hyder (DE - SF) 9.0\nErna poner (ole -TB) 9.0\nStephon Tuitt (DE - PIT) 9.0\n&quot;</code></pre>
</div>
<p>Ultimately, it does pretty well! But you can see that there are some “misses” if we look closely. Let’s make it easier on the OCR engine by cleaning up the image for higher contrast.</p>
<h2 id="remove-the-background-and-grid">Remove the background and grid</h2>
<p>We’ll first start by converting the color image to greyscale via <code>image_quantize()</code>.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>raw_img</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://docs.ropensci.org/magick/reference/color.html'>image_quantize</a></span><span class='op'>(</span>colorspace <span class='op'>=</span> <span class='st'>"gray"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://docs.ropensci.org/magick/reference/image_ggplot.html'>image_ggplot</a></span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="reading-tables-from-images-with-magick_files/figure-html5/unnamed-chunk-5-1.png" width="624" /></p>
</div>
<p>We can remove the grid by converting “white” colors to transparent, and allowing for some “fuzzy” approximation of colors that are close to white or “touching”. There’s a lot more to <code>fuzz</code> in that it’s the “relative color distance (value between 0 and 100) to be considered similar in the filling algorithm”, but I’m not a color space expert by any means.</p>
<p>Below we have an example of <code>fuzz = 0</code>, <code>fuzz = 20</code>, <code>fuzz = 40</code>, <code>fuzz = 60</code>. Each increase does remove a bit of “noise”, but is also reducing the quality of the “signal”.</p>
<details>
<summary>
Code for Combo
</summary>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>fuzz_fun</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>fuzz</span><span class='op'>)</span><span class='op'>{</span>
  <span class='va'>raw_img</span> <span class='op'>%&gt;%</span> 
    <span class='fu'><a href='https://docs.ropensci.org/magick/reference/color.html'>image_quantize</a></span><span class='op'>(</span>colorspace <span class='op'>=</span> <span class='st'>"gray"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
    <span class='fu'><a href='https://docs.ropensci.org/magick/reference/color.html'>image_transparent</a></span><span class='op'>(</span>color <span class='op'>=</span> <span class='st'>"white"</span>, fuzz<span class='op'>=</span><span class='va'>fuzz</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
    <span class='fu'><a href='https://docs.ropensci.org/magick/reference/color.html'>image_background</a></span><span class='op'>(</span><span class='st'>"white"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
    <span class='fu'><a href='https://docs.ropensci.org/magick/reference/transform.html'>image_crop</a></span><span class='op'>(</span><span class='fu'><a href='https://docs.ropensci.org/magick/reference/geometry.html'>geometry_area</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>150</span>,<span class='fl'>110</span>, <span class='fl'>45</span><span class='op'>)</span><span class='op'>)</span>
<span class='op'>}</span>

<span class='fu'>fuzz_fun</span><span class='op'>(</span><span class='fl'>20</span><span class='op'>)</span>
</code></pre>
</div>
<img src="reading-tables-from-images-with-magick_files/figure-html5/unnamed-chunk-6-1.png" width="300" />
<div class="sourceCode">
<pre><code><span class='va'>combo_fuzz</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>
  <span class='fu'>fuzz_fun</span><span class='op'>(</span><span class='fl'>0</span><span class='op'>)</span>,
  <span class='fu'>fuzz_fun</span><span class='op'>(</span><span class='fl'>20</span><span class='op'>)</span>,
  <span class='fu'>fuzz_fun</span><span class='op'>(</span><span class='fl'>40</span><span class='op'>)</span>,
  <span class='fu'>fuzz_fun</span><span class='op'>(</span><span class='fl'>60</span><span class='op'>)</span>
<span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://docs.ropensci.org/magick/reference/animation.html'>image_append</a></span><span class='op'>(</span>stack <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span> 
</code></pre>
</div>
</div>
</details>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='fu'><a href='https://docs.ropensci.org/magick/reference/image_ggplot.html'>image_ggplot</a></span><span class='op'>(</span><span class='va'>combo_fuzz</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="reading-tables-from-images-with-magick_files/figure-html5/unnamed-chunk-7-1.png" width="624" /></p>
</div>
<p>In practical terms, we are balancing increase <code>fuzz</code> to remove unnecessary components (eg grid lines) while leaving the actual characters there. Increasing fuzz will remove more “noise” but will eventually start to eat away at the actual “signal” as well.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>no_grid</span> <span class='op'>&lt;-</span> <span class='va'>raw_img</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://docs.ropensci.org/magick/reference/color.html'>image_quantize</a></span><span class='op'>(</span>colorspace <span class='op'>=</span> <span class='st'>"gray"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
   <span class='fu'><a href='https://docs.ropensci.org/magick/reference/color.html'>image_transparent</a></span><span class='op'>(</span>color <span class='op'>=</span> <span class='st'>"white"</span>, fuzz<span class='op'>=</span><span class='fl'>20</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
   <span class='fu'><a href='https://docs.ropensci.org/magick/reference/color.html'>image_background</a></span><span class='op'>(</span><span class='st'>"white"</span><span class='op'>)</span> 

<span class='fu'><a href='https://docs.ropensci.org/magick/reference/image_ggplot.html'>image_ggplot</a></span><span class='op'>(</span><span class='va'>no_grid</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="reading-tables-from-images-with-magick_files/figure-html5/unnamed-chunk-8-1.png" width="624" /></p>
</div>
<p>So we’ve taken white and converted it to transparent, and then set the image background back to “white”.</p>
<p>You can also remove continuous lines with a “thinning” method. We can use <code>image_morphology()</code> coupled with a rectangular kernel to remove straight horizontal lines for the most part. You can read <code>Rectangle:20x1</code> as finding rectangles about 20 pixels wide x 1 pixel high. We couple this with <code>image_negate()</code> as otherwise it will focus on the characters.</p>
<p>So we’ll <code>negate</code> &gt; <code>thin</code> &gt; <code>negate</code> to get back to our white background sans grid-lines. While this works pretty well, it’s not <em>always</em> necessary for the OCR. I did want to show it as it can be helpful in some situations.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>no_grid</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://docs.ropensci.org/magick/reference/effects.html'>image_negate</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://docs.ropensci.org/magick/reference/image_ggplot.html'>image_ggplot</a></span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="reading-tables-from-images-with-magick_files/figure-html5/unnamed-chunk-9-1.png" width="624" /></p>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>no_grid</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://docs.ropensci.org/magick/reference/effects.html'>image_negate</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='co'># negate</span>
  <span class='fu'><a href='https://docs.ropensci.org/magick/reference/morphology.html'>image_morphology</a></span><span class='op'>(</span>method <span class='op'>=</span> <span class='st'>"Thinning"</span>, kernel <span class='op'>=</span> <span class='st'>"Rectangle:20x1"</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://docs.ropensci.org/magick/reference/effects.html'>image_negate</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='co'># back to white</span>
  <span class='fu'><a href='https://docs.ropensci.org/magick/reference/image_ggplot.html'>image_ggplot</a></span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="reading-tables-from-images-with-magick_files/figure-html5/unnamed-chunk-10-1.png" width="624" /></p>
</div>
<p>This worked pretty well! However, remember that we don’t always have to do this. We’ll also still need to crop the image to remove the team logos as they can’t be parsed as text.</p>
<h2 id="crop-the-image">Crop the image</h2>
<p><code>geometry_area()</code> is used in various functions to indicate the starting width/heights and then the offset, all in pixels.</p>
<blockquote>
<p><code>geometry_area(width = NULL, height = NULL, x_off = 0, y_off = 0)</code></p>
</blockquote>
<p>Note that you’re always “starting” from the top and left sides, and we’re passing the <code>geometry_area()</code> to <code>image_crop</code> to crop the image itself.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='co'># remove the top 20 pixels</span>
<span class='va'>no_grid</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://docs.ropensci.org/magick/reference/transform.html'>image_crop</a></span><span class='op'>(</span><span class='fu'><a href='https://docs.ropensci.org/magick/reference/geometry.html'>geometry_area</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>0</span>,<span class='fl'>110</span>, <span class='fl'>45</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://docs.ropensci.org/magick/reference/image_ggplot.html'>image_ggplot</a></span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="reading-tables-from-images-with-magick_files/figure-html5/unnamed-chunk-11-1.png" width="624" /></p>
</div>
<p>So this techniques can be used to cut out specific portions of an image, which is another useful technique for tricky columns. For now, let’s hope we can use ALL the data together.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>no_grid_crop</span> <span class='op'>&lt;-</span> <span class='va'>no_grid</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://docs.ropensci.org/magick/reference/transform.html'>image_crop</a></span><span class='op'>(</span><span class='fu'><a href='https://docs.ropensci.org/magick/reference/geometry.html'>geometry_area</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>0</span>,<span class='fl'>110</span>, <span class='fl'>45</span><span class='op'>)</span><span class='op'>)</span>

<span class='va'>no_grid_crop</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://docs.ropensci.org/magick/reference/image_ggplot.html'>image_ggplot</a></span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="reading-tables-from-images-with-magick_files/figure-html5/unnamed-chunk-12-1.png" width="624" /></p>
</div>
<h2 id="try-ocr">Try OCR</h2>
<p>We can try our first OCR now! Note that <code>image_ocr()</code> is just calling <code>tesseract</code> behind the scenes.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>no_grid_crop</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://docs.ropensci.org/magick/reference/ocr.html'>image_ocr</a></span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] &quot;Aaron Donald (DE - LA) 19.0\nMyles Garrett (DE - CLE) 16.5\nT.J. Watt (OLB - PIT) 14.5\nKhalil Mack (OLB - CHI) 13.0\nJustin Houston (DE - IND) 12.0\nEmmanuel Ogbah (DE - MIA) 11.0\nCarl Lawson (DE - CIN) 10.5\nBrandon Graham (DE - PHI) 10.0\nDeMarcus Lawrence (DE - DAL) 10.0\nYannick Ngakoue (DE - BAL) 10.0\nMontez Sweat (DE - WAS) 10.0\nCarlos Dunlap (DE - SEA) 9.0\nCameron Jordan (DE - NO) 9.0\nKerry Hyder (DE - SF) 9.0\nShaquil Barrett (OLB - TB) 9.0\nStephon Tuitt (DE - PIT) 9.0\nRomeo Okwara (DE - DET) 9.0\n&quot;</code></pre>
</div>
<p>This did a great job, but what about this raw text string we ended up with? Also note that <code>image_ocr()</code> is just a wrapper around <code>tesseract::ocr()</code>.</p>
<p>Let’s go into <code>tesseract</code> proper to try some robust things out!</p>
<p>I’m going to focus on one numeric “column” first to keep things relatively simpler. We’ll use <code>image_crop</code> to grab the column of interest, then we’ll call <code>tesseract::ocr()</code> on it. We can provide some options to the engine, namely that we’re expecting only spaces, numbers, or a decimal. This will explicitly prevent 5 being converted to S for example. It does really well here!</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>num_only</span> <span class='op'>&lt;-</span> <span class='fu'>tesseract</span><span class='fu'>::</span><span class='fu'><a href='https://docs.ropensci.org/tesseract/reference/tesseract.html'>tesseract</a></span><span class='op'>(</span>
  options <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>tessedit_char_whitelist <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>".0123456789 "</span><span class='op'>)</span><span class='op'>)</span>
  <span class='op'>)</span>

<span class='va'>no_grid</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://docs.ropensci.org/magick/reference/color.html'>image_quantize</a></span><span class='op'>(</span>colorspace <span class='op'>=</span> <span class='st'>'gray'</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://docs.ropensci.org/magick/reference/thresholding.html'>image_threshold</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://docs.ropensci.org/magick/reference/transform.html'>image_crop</a></span><span class='op'>(</span><span class='fu'><a href='https://docs.ropensci.org/magick/reference/geometry.html'>geometry_area</a></span><span class='op'>(</span><span class='fl'>100</span>, <span class='fl'>0</span>, <span class='fl'>600</span>, <span class='fl'>40</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://docs.ropensci.org/magick/reference/ocr.html'>ocr</a></span><span class='op'>(</span>engine <span class='op'>=</span> <span class='va'>num_only</span><span class='op'>)</span> 
</code></pre>
</div>
<pre><code>[1] &quot;19.0\n16.5\n14.5\n13.0\n12.0\n11.0\n10.5\n10.0\n10.0\n10.0\n10.0\n9.0\n9.0\n9.0\n9.0\n9.0\n9.0\n&quot;</code></pre>
</div>
<p>But we have text, numbers, and some symbols like <code>(</code>.</p>
<p>So let’s pass those as limitations to the engine, and then we can take the raw text and turn it into a dataframe/tibble.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>combo</span> <span class='op'>&lt;-</span> <span class='fu'>tesseract</span><span class='fu'>::</span><span class='fu'><a href='https://docs.ropensci.org/tesseract/reference/tesseract.html'>tesseract</a></span><span class='op'>(</span>
    options <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>
      tessedit_char_whitelist <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span>
        <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>letters</span>, <span class='va'>LETTERS</span>, <span class='st'>" "</span>, <span class='st'>".0123456789 (-)"</span><span class='op'>)</span>, collapse <span class='op'>=</span> <span class='st'>""</span><span class='op'>)</span>
      <span class='op'>)</span>
  <span class='op'>)</span>

<span class='va'>raw_text</span> <span class='op'>&lt;-</span> <span class='va'>no_grid</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://docs.ropensci.org/magick/reference/color.html'>image_quantize</a></span><span class='op'>(</span>colorspace <span class='op'>=</span> <span class='st'>"gray"</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://docs.ropensci.org/magick/reference/color.html'>image_transparent</a></span><span class='op'>(</span><span class='st'>"white"</span>, fuzz <span class='op'>=</span> <span class='fl'>22</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://docs.ropensci.org/magick/reference/color.html'>image_background</a></span><span class='op'>(</span><span class='st'>"white"</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://docs.ropensci.org/magick/reference/thresholding.html'>image_threshold</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://docs.ropensci.org/magick/reference/transform.html'>image_crop</a></span><span class='op'>(</span><span class='fu'><a href='https://docs.ropensci.org/magick/reference/geometry.html'>geometry_area</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>0</span>, <span class='fl'>110</span>, <span class='fl'>45</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>  
  <span class='fu'><a href='https://docs.ropensci.org/magick/reference/ocr.html'>ocr</a></span><span class='op'>(</span>engine <span class='op'>=</span> <span class='va'>combo</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<h2 id="make-a-tibble">Make a Tibble</h2>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>raw_text</span>
</code></pre>
</div>
<pre><code>[1] &quot;Aaron Donald (DE - LA) 19.0\nMyles Garrett (DE - CLE) 16.5\nT.J. Watt (OLB - PIT) 14.5\nKhalil Mack (OLB - CHI) 13.0\nJustin Houston (DE - IND) 12.0\nEmmanuel Ogbah (DE - MIA) 11.0\nCarl Lawson (DE - CIN) 10.5\nBrandon Graham (DE - PHI) 10.0\nDeMarcus Lawrence (DE - DAL) 10.0\nYannick Ngakoue (DE - BAL) 10.0\nMontez Sweat (DE - WAS) 10.0\nCarlos Dunlap (DE - SEA) 9.0\nCameron Jordan (DE - NO) 9.0\nKerry Hyder (DE - SF) 9.0\nShaquil Barrett (OLB - TB) 9.0\nStephon Tuitt (DE - PIT) 9.0\nRomeo Okwara (DE - DET) 9.0\n&quot;</code></pre>
</div>
<p>This looks pretty much perfect! We just now need to get it into a dataframe. We can accomplish this by splitting on each new row (<code>\n</code>) and then adding that as a column in a tibble.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>raw_tibble</span> <span class='op'>&lt;-</span> <span class='va'>raw_text</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>str_split</span><span class='op'>(</span>pattern <span class='op'>=</span> <span class='st'>"\n"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://rdrr.io/r/base/unlist.html'>unlist</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>tibble</span><span class='op'>(</span>data <span class='op'>=</span> <span class='va'>.</span><span class='op'>)</span> 

<span class='va'>raw_tibble</span>
</code></pre>
</div>
<pre><code># A tibble: 18 x 1
   data                               
   &lt;chr&gt;                              
 1 &quot;Aaron Donald (DE - LA) 19.0&quot;      
 2 &quot;Myles Garrett (DE - CLE) 16.5&quot;    
 3 &quot;T.J. Watt (OLB - PIT) 14.5&quot;       
 4 &quot;Khalil Mack (OLB - CHI) 13.0&quot;     
 5 &quot;Justin Houston (DE - IND) 12.0&quot;   
 6 &quot;Emmanuel Ogbah (DE - MIA) 11.0&quot;   
 7 &quot;Carl Lawson (DE - CIN) 10.5&quot;      
 8 &quot;Brandon Graham (DE - PHI) 10.0&quot;   
 9 &quot;DeMarcus Lawrence (DE - DAL) 10.0&quot;
10 &quot;Yannick Ngakoue (DE - BAL) 10.0&quot;  
11 &quot;Montez Sweat (DE - WAS) 10.0&quot;     
12 &quot;Carlos Dunlap (DE - SEA) 9.0&quot;     
13 &quot;Cameron Jordan (DE - NO) 9.0&quot;     
14 &quot;Kerry Hyder (DE - SF) 9.0&quot;        
15 &quot;Shaquil Barrett (OLB - TB) 9.0&quot;   
16 &quot;Stephon Tuitt (DE - PIT) 9.0&quot;     
17 &quot;Romeo Okwara (DE - DET) 9.0&quot;      
18 &quot;&quot;                                 </code></pre>
</div>
<p>Now we have essentially perfect data at this point, we just need to separate out our columns and drop the row without any data.</p>
<h2 id="tidy-the-tibble">Tidy the Tibble</h2>
<p>We’ll first drop any rows where the character string is &lt; 2. We can then use <code>tidyr::separate()</code> to separate one column into 4 new columns as player, position, team, and sacks. There are multiple separators, which for the example seen <code>T.J. Watt (OLB - PIT) 14.5</code> are:</p>
<ul>
<li><code>T.J.Watt</code> then <code>(</code> represented as “<code>\\(</code>”<br />
</li>
<li><code>OLB</code> then <code>-</code> represented as “<code>-</code>”<br />
</li>
<li><code>PIT</code> then <code>)</code> represented as “<code>\\)</code>”<br />
</li>
<li>which leaves us with <code>14.5</code> at the end</li>
</ul>
<p>We have to “escape” the parentheses with <code>\\</code> so that regex can understand them. The <code>|</code> inside the sep arguments tell the regex to separate at a match of a white-space + parentheses OR white-space + dash OR parentheses + white-space.</p>
<p>As our last step, we’ll convert sacks to a double column, and then <strong>BOOM</strong>!</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>raw_tibble</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='fu'>str_length</span><span class='op'>(</span><span class='va'>data</span><span class='op'>)</span> <span class='op'>&gt;=</span> <span class='fl'>2</span><span class='op'>)</span>  <span class='op'>%&gt;%</span>
  <span class='fu'>separate</span><span class='op'>(</span>
    <span class='va'>data</span>, 
    into <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"player"</span>, <span class='st'>"position"</span>, <span class='st'>"team"</span>, <span class='st'>"sacks"</span><span class='op'>)</span>, 
    sep <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>" \\(| - |\\) "</span><span class='op'>)</span>
    <span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>mutate</span><span class='op'>(</span>sacks <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/double.html'>as.double</a></span><span class='op'>(</span><span class='va'>sacks</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code># A tibble: 17 x 4
   player            position team  sacks
   &lt;chr&gt;             &lt;chr&gt;    &lt;chr&gt; &lt;dbl&gt;
 1 Aaron Donald      DE       LA     19  
 2 Myles Garrett     DE       CLE    16.5
 3 T.J. Watt         OLB      PIT    14.5
 4 Khalil Mack       OLB      CHI    13  
 5 Justin Houston    DE       IND    12  
 6 Emmanuel Ogbah    DE       MIA    11  
 7 Carl Lawson       DE       CIN    10.5
 8 Brandon Graham    DE       PHI    10  
 9 DeMarcus Lawrence DE       DAL    10  
10 Yannick Ngakoue   DE       BAL    10  
11 Montez Sweat      DE       WAS    10  
12 Carlos Dunlap     DE       SEA     9  
13 Cameron Jordan    DE       NO      9  
14 Kerry Hyder       DE       SF      9  
15 Shaquil Barrett   OLB      TB      9  
16 Stephon Tuitt     DE       PIT     9  
17 Romeo Okwara      DE       DET     9  </code></pre>
</div>
<h2 id="write-it-as-a-function">Write it as a Function</h2>
<p>We can wrap this process into a reusable function, and then call it on our 3 images of interest!</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>scrape_fun</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>url_in</span>, <span class='va'>crop_left</span>, <span class='va'>crop_top</span><span class='op'>)</span><span class='op'>{</span>
  <span class='va'>raw_img</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://docs.ropensci.org/magick/reference/editing.html'>image_read</a></span><span class='op'>(</span><span class='va'>url_in</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
    <span class='fu'><a href='https://docs.ropensci.org/magick/reference/color.html'>image_quantize</a></span><span class='op'>(</span>colorspace <span class='op'>=</span> <span class='st'>'gray'</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'><a href='https://docs.ropensci.org/magick/reference/color.html'>image_transparent</a></span><span class='op'>(</span><span class='st'>"white"</span>, fuzz<span class='op'>=</span><span class='fl'>22</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
    <span class='fu'><a href='https://docs.ropensci.org/magick/reference/color.html'>image_background</a></span><span class='op'>(</span><span class='st'>"white"</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'><a href='https://docs.ropensci.org/magick/reference/thresholding.html'>image_threshold</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
    <span class='fu'><a href='https://docs.ropensci.org/magick/reference/transform.html'>image_crop</a></span><span class='op'>(</span><span class='fu'><a href='https://docs.ropensci.org/magick/reference/geometry.html'>geometry_area</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>0</span>, <span class='va'>crop_left</span>, <span class='va'>crop_top</span><span class='op'>)</span><span class='op'>)</span> 
  
  <span class='fu'><a href='https://docs.ropensci.org/magick/reference/ocr.html'>image_ocr</a></span><span class='op'>(</span><span class='va'>raw_img</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
    <span class='fu'>str_c</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
    <span class='fu'>str_split</span><span class='op'>(</span>pattern <span class='op'>=</span> <span class='st'>"\n"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
    <span class='fu'><a href='https://rdrr.io/r/base/unlist.html'>unlist</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'>tibble</span><span class='op'>(</span>data <span class='op'>=</span> <span class='va'>.</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
    <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='fu'>str_length</span><span class='op'>(</span><span class='va'>data</span><span class='op'>)</span> <span class='op'>&gt;=</span> <span class='fl'>2</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
    <span class='fu'>separate</span><span class='op'>(</span>
      <span class='va'>data</span>, 
      into <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"player"</span>, <span class='st'>"position"</span>, <span class='st'>"team"</span>, <span class='st'>"sacks"</span><span class='op'>)</span>, 
      sep <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>" \\(| - |\\) "</span><span class='op'>)</span>
      <span class='op'>)</span> <span class='op'>%&gt;%</span> 
    <span class='fu'>mutate</span><span class='op'>(</span>sacks <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/double.html'>as.double</a></span><span class='op'>(</span><span class='va'>sacks</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
    <span class='fu'>mutate</span><span class='op'>(</span>sacks <span class='op'>=</span> <span class='fu'>if_else</span><span class='op'>(</span><span class='va'>sacks</span> <span class='op'>&gt;=</span> <span class='fl'>20</span>, <span class='va'>sacks</span><span class='op'>/</span><span class='fl'>10</span>, <span class='va'>sacks</span><span class='op'>)</span><span class='op'>)</span>
<span class='op'>}</span>
</code></pre>
</div>
</div>
<p>We can then call our new function! You may notice that I added a <code>mutate</code> above which protects against missing decimal places. Trey Hendrickson’s decimal place is apparently hard for the parser to “capture”.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='co'># output to tibble</span>
<span class='va'>cr_sacks</span> <span class='op'>&lt;-</span> <span class='fu'>tibble</span><span class='op'>(</span>
  url_in <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>
    <span class='st'>"https://pbs.twimg.com/media/ErtmQ1PXYAEUQoY?format=jpg&amp;name=900x900"</span>,
    <span class='st'>"https://pbs.twimg.com/media/ErtmSLlXMAAvylA?format=jpg&amp;name=900x900"</span>,
    <span class='st'>"https://pbs.twimg.com/media/ErtmTUGW8AEZ6Cy?format=jpg&amp;name=900x900"</span>
    <span class='op'>)</span>,
  crop_left <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>110</span>, <span class='fl'>95</span>, <span class='fl'>95</span><span class='op'>)</span>,
  crop_top <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>45</span>, <span class='fl'>5</span>, <span class='fl'>5</span><span class='op'>)</span>
<span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>pmap_df</span><span class='op'>(</span><span class='va'>scrape_fun</span><span class='op'>)</span>

<span class='va'>cr_sacks</span>
</code></pre>
</div>
<pre><code># A tibble: 46 x 4
   player            position team  sacks
   &lt;chr&gt;             &lt;chr&gt;    &lt;chr&gt; &lt;dbl&gt;
 1 Aaron Donald      DE       LA     19  
 2 Myles Garrett     DE       CLE    16.5
 3 T.J. Watt         OLB      PIT    14.5
 4 Khalil Mack       OLB      CHI    13  
 5 Justin Houston    DE       IND    12  
 6 Emmanuel Ogbah    DE       MIA    11  
 7 Carl Lawson       DE       CIN    10.5
 8 Brandon Graham    DE       PHI    10  
 9 DeMarcus Lawrence DE       DAL    10  
10 Yannick Ngakoue   DE       BAL    10  
# … with 36 more rows</code></pre>
</div>
<p>We can plot it just to be safe, and to see if everything “checks out”! We get a range we expected, and see that T.J. Watt and Aaron Donald create many more of their own sacks relative to their positions.</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre><code><span class='va'>cr_sacks</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>mutate</span><span class='op'>(</span>position <span class='op'>=</span> <span class='fu'>if_else</span><span class='op'>(</span><span class='va'>position</span> <span class='op'>==</span> <span class='st'>"LB"</span>, <span class='st'>"OLB"</span>, <span class='va'>position</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>ggplot</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>sacks</span>, y <span class='op'>=</span> <span class='va'>position</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>ggridges</span><span class='fu'>::</span><span class='fu'><a href='https://wilkelab.org/ggridges/reference/geom_density_ridges.html'>geom_density_ridges</a></span><span class='op'>(</span>quantile_lines <span class='op'>=</span> <span class='cn'>TRUE</span>, quantiles <span class='op'>=</span> <span class='fl'>2</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_point</span><span class='op'>(</span>
    data <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>cr_sacks</span>, <span class='va'>player</span> <span class='op'>%in%</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Aaron Donald"</span>, <span class='st'>"T.J. Watt"</span><span class='op'>)</span><span class='op'>)</span>,
    size <span class='op'>=</span> <span class='fl'>3</span>
    <span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>ggridges</span><span class='fu'>::</span><span class='fu'><a href='https://wilkelab.org/ggridges/reference/theme_ridges.html'>theme_ridges</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>theme</span><span class='op'>(</span>
    axis.text <span class='op'>=</span> <span class='fu'>element_text</span><span class='op'>(</span>size <span class='op'>=</span> <span class='fl'>10</span><span class='op'>)</span>,
    axis.title <span class='op'>=</span> <span class='fu'>element_text</span><span class='op'>(</span>size <span class='op'>=</span> <span class='fl'>14</span><span class='op'>)</span>,
    plot.title <span class='op'>=</span> <span class='fu'>element_text</span><span class='op'>(</span>size <span class='op'>=</span> <span class='fl'>16</span><span class='op'>)</span>,
    plot.caption <span class='op'>=</span> <span class='fu'>element_text</span><span class='op'>(</span>size <span class='op'>=</span> <span class='fl'>10</span><span class='op'>)</span>,
    panel.grid.minor <span class='op'>=</span> <span class='fu'>element_blank</span><span class='op'>(</span><span class='op'>)</span>,
    axis.title.x <span class='op'>=</span> <span class='fu'>element_text</span><span class='op'>(</span>hjust <span class='op'>=</span> <span class='fl'>0</span><span class='op'>)</span>
    <span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>labs</span><span class='op'>(</span>
    x <span class='op'>=</span> <span class='st'>"\nCreated Sacks"</span>, y <span class='op'>=</span> <span class='st'>""</span>,
    title <span class='op'>=</span> <span class='st'>"T.J. Watt and A. Donald are both outliers amongst their positions"</span>,
    subtitle <span class='op'>=</span> <span class='st'>"Created Sacks by position"</span>,
    caption <span class='op'>=</span> <span class='st'>"Data: ESPN | Plot: @thomas_mock"</span>
    <span class='op'>)</span>
</code></pre>
</div>
<p><img src="reading-tables-from-images-with-magick_files/figure-html5/unnamed-chunk-21-1.png" width="1500" /></p>
</div>
<h1 id="example-2">Example 2</h1>
<p>Example two is from Brian Burke, who was kind enough to share the raw data for NFL playoff leverage for week 17 as a screenshot. At the time, I manually copied these over to a dataframe, but Ben Baldwin asked if there was a “better” way. Image OCR (optical character recognition) is a potentially more reproducible way!</p>
<blockquote class="twitter-tweet">
<p lang="en" dir="ltr">
Sorry, no pretty charts for now. But here are the raw numbers. <a href="https://t.co/wZ3j9bXzTN">pic.twitter.com/wZ3j9bXzTN</a>
</p>
— Brian Burke (<span class="citation" data-cites="bburkeESPN">@bburkeESPN</span>) <a href="https://twitter.com/bburkeESPN/status/1339616433408528384?ref_src=twsrc%5Etfw">December 17, 2020</a>
</blockquote>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
<p>Note that our process is almost identical to the previous example, but there are some considerations as the image is a bit more difficult to work with.</p>
<p>Now, this image is more problematic for two main reasons.</p>
<ol type="1">
<li>The image itself is <em>much</em> smaller, specifically about 60% smaller than our previous example and of low quality<br />
</li>
<li>The fonts in use are worse (not monospaced and have serifs), and not bold</li>
</ol>
<p>This is going to be <strong>harder</strong> than before.</p>
<h2 id="get-the-raw-img">Get the raw img</h2>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>burke</span> <span class='op'>&lt;-</span> <span class='st'>"https://pbs.twimg.com/media/EpdF4fzW4AEeOvF?format=png&amp;name=small"</span>
<span class='va'>raw_img</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://docs.ropensci.org/magick/reference/editing.html'>image_read</a></span><span class='op'>(</span><span class='va'>burke</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>Now, again while interactively you can just “print” the <code>magick</code> object and it will show up in the RStudio viewer pane, for this blog-post I’ll need to explicitly “show” it. I’ll call <code>magick::image_ggplot(&lt;img object&gt;)</code> to print it throughout the post.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='fu'><a href='https://docs.ropensci.org/magick/reference/image_ggplot.html'>image_ggplot</a></span><span class='op'>(</span><span class='va'>raw_img</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="reading-tables-from-images-with-magick_files/figure-html5/unnamed-chunk-23-1.png" width="624" /></p>
</div>
<p>This looks like a relatively clean image, the only major problems as mentioned above are that it’s very low-quality along with not ideal fonts, and it cuts off some of the data for team.</p>
<h2 id="clean-it-up">Clean it up</h2>
<p>We can remove the grid by converting “white” colors to transparent, and allowing for some “fuzzy” approximation of colors that are close to white or “touching”. There’s a lot more to <code>fuzz</code> in that it’s the “relative color distance (value between 0 and 100) to be considered similar in the filling algorithm”, but I’m not a color space expert by any means.</p>
<p>In practical terms, we are balancing increase <code>fuzz</code> to remove unnecessary components (eg grid lines) while leaving the actual characters there. Increasing fuzz will remove more “noise” but will eventually start to eat away at the actual “signal” as well.</p>
<p>Below we have an example of <code>fuzz = 0</code>, <code>fuzz = 20</code>, <code>fuzz = 50</code>, <code>fuzz = 70</code>.</p>
<p>So we’ve taken white and converted it to transparent, and then set the image background back to “white”.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>no_grid</span> <span class='op'>&lt;-</span> <span class='va'>raw_img</span> <span class='op'>%&gt;%</span> 
   <span class='fu'><a href='https://docs.ropensci.org/magick/reference/color.html'>image_transparent</a></span><span class='op'>(</span>color <span class='op'>=</span> <span class='st'>"white"</span>, fuzz<span class='op'>=</span><span class='fl'>20</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
   <span class='fu'><a href='https://docs.ropensci.org/magick/reference/color.html'>image_background</a></span><span class='op'>(</span><span class='st'>"white"</span><span class='op'>)</span> 

<span class='fu'><a href='https://docs.ropensci.org/magick/reference/image_ggplot.html'>image_ggplot</a></span><span class='op'>(</span><span class='va'>no_grid</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="reading-tables-from-images-with-magick_files/figure-html5/unnamed-chunk-24-1.png" width="624" /></p>
</div>
<p>You can also remove continuous lines with a “thinning” method. We can use <code>image_morphology()</code> coupled with a rectangular kernel to remove straight horizontal lines for the most part. You can read <code>Rectangle:20x1</code> as finding rectangles about 20 pixels wide x 1 pixel high. We couple this with <code>image_negate()</code> as otherwise it will focus on the characters.</p>
<p>So we’ll <code>negate</code> &gt; <code>thin</code> &gt; <code>negate</code> to get back to our white background sans grid-lines.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>no_grid</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://docs.ropensci.org/magick/reference/effects.html'>image_negate</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://docs.ropensci.org/magick/reference/image_ggplot.html'>image_ggplot</a></span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="reading-tables-from-images-with-magick_files/figure-html5/unnamed-chunk-25-1.png" width="624" /></p>
</div>
<p>We can apply the thinning morph as seen below, flipping back and forth with <code>image_negate()</code>.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>no_grid</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://docs.ropensci.org/magick/reference/effects.html'>image_negate</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://docs.ropensci.org/magick/reference/morphology.html'>image_morphology</a></span><span class='op'>(</span>method <span class='op'>=</span> <span class='st'>"Thinning"</span>, kernel <span class='op'>=</span> <span class='st'>"Rectangle:20x1"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://docs.ropensci.org/magick/reference/effects.html'>image_negate</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://docs.ropensci.org/magick/reference/image_ggplot.html'>image_ggplot</a></span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="reading-tables-from-images-with-magick_files/figure-html5/unnamed-chunk-26-1.png" width="624" /></p>
</div>
<p>This worked pretty well! However, because of the mis-alignment of the column labels and the columns themselves, I’m just going to trim the top off.</p>
<h2 id="crop-the-image-1">Crop the image</h2>
<p><code>geometry_area()</code> is used in various functions to indicate the starting width/heights and then the offset, all in pixels.</p>
<blockquote>
<p><code>geometry_area(width = NULL, height = NULL, x_off = 0, y_off = 0)</code></p>
</blockquote>
<p>Note that you’re always “starting” from the top and left sides, and we’re passing the <code>geometry_area()</code> to <code>image_crop</code> to crop the image itself.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='co'># remove the top 20 pixels</span>
<span class='va'>no_grid</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://docs.ropensci.org/magick/reference/transform.html'>image_crop</a></span><span class='op'>(</span><span class='fu'><a href='https://docs.ropensci.org/magick/reference/geometry.html'>geometry_area</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>0</span>, <span class='fl'>0</span>, <span class='fl'>20</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://docs.ropensci.org/magick/reference/image_ggplot.html'>image_ggplot</a></span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="reading-tables-from-images-with-magick_files/figure-html5/unnamed-chunk-27-1.png" width="624" /></p>
</div>
<p>So this techniques can be used to cut out specific portions of an image, which is another useful technique for tricky columns. For now, let’s hope we can use ALL the data together.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>no_grid_crop</span> <span class='op'>&lt;-</span> <span class='va'>no_grid</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://docs.ropensci.org/magick/reference/transform.html'>image_crop</a></span><span class='op'>(</span><span class='fu'><a href='https://docs.ropensci.org/magick/reference/geometry.html'>geometry_area</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>0</span>, <span class='fl'>0</span>, <span class='fl'>20</span><span class='op'>)</span><span class='op'>)</span>

<span class='va'>no_grid_crop</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://docs.ropensci.org/magick/reference/image_ggplot.html'>image_ggplot</a></span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="reading-tables-from-images-with-magick_files/figure-html5/unnamed-chunk-28-1.png" width="624" /></p>
</div>
<h2 id="try-ocr-1">Try OCR</h2>
<p>We can try our first OCR now! Note that <code>image_ocr()</code> is just calling <code>tesseract</code> behind the scenes.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>no_grid_crop</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://docs.ropensci.org/magick/reference/ocr.html'>image_ocr</a></span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] &quot;Bills 100 99.3 07\nPackers 100 100 0\nRams 100989 11\nChiefs 100 100 0\nsaints 100 100 0\nSeahawks 100 (97.7 23\nSteelers 100 100 0\nBuccaneer 99.5 92.6 69\nTitans 97.6 787 18.9\nColts 94.9 6640285\nBrowns 946 0 «675 TA\nRavens 90.1 S18 383\nFootballT 88.6 583 303\nCardinals 65.7. 25.7 40\nDolphins 48.7 14 353\nGiants 413 10-313\nBears 35.3 18 (335\nVikings 317 430 278\nRaiders 29.1 45 246\nEagles 18.3 3400 149\n49ers 14.5 os 14\nPatriots 58 0 58\nCowboys 23 0 23\nLions 19 0 19\nPanthers O41 oO O41\n&quot;</code></pre>
</div>
<p>This did a decent job, but I can already see some “problems”.</p>
<p>The Rams row is “squished” together, the Browns have some letters instead of numbers, and the Ravens have a “S” instead of a 5.</p>
<p>Let’s go into <code>tesseract</code> proper to try some robust things out!</p>
<p>I’m going to focus on one “column” first to keep things relatively simpler. We’ll use <code>image_crop</code> to grab the column of interest, then we’ll call <code>tesseract::ocr()</code> on it. We can provide some options to the engine, namely that we’re expecting only spaces, numbers, or a decimal. This will explicitly prevent 5 being converted to S for example.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>num_only</span> <span class='op'>&lt;-</span> <span class='fu'>tesseract</span><span class='fu'>::</span><span class='fu'><a href='https://docs.ropensci.org/tesseract/reference/tesseract.html'>tesseract</a></span><span class='op'>(</span>
  options <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>tessedit_char_whitelist <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>".0123456789 "</span><span class='op'>)</span><span class='op'>)</span>
  <span class='op'>)</span>
<span class='va'>no_grid</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://docs.ropensci.org/magick/reference/color.html'>image_quantize</a></span><span class='op'>(</span>colorspace <span class='op'>=</span> <span class='st'>'gray'</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://docs.ropensci.org/magick/reference/thresholding.html'>image_threshold</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://docs.ropensci.org/magick/reference/transform.html'>image_crop</a></span><span class='op'>(</span><span class='fu'><a href='https://docs.ropensci.org/magick/reference/geometry.html'>geometry_area</a></span><span class='op'>(</span><span class='fl'>80</span>, <span class='fl'>0</span>, <span class='fl'>80</span>, <span class='fl'>20</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://docs.ropensci.org/magick/reference/ocr.html'>ocr</a></span><span class='op'>(</span>engine <span class='op'>=</span> <span class='va'>num_only</span><span class='op'>)</span> 
</code></pre>
</div>
<pre><code>[1] &quot;100\n100\n100\n100\n100\n100\n100\n99.5\n97.6\n94.9\n94.6\n90.1\n28.6\n657\n48.7\n41.3\n35.3\n317\n29.1\n18.3\n14.5\n5.8\n2.3\n1.9\n01\n&quot;</code></pre>
</div>
<p>I’m going to “plot” the data to show some areas where mistakes were <em>still</em> made. We know that 100 is the max, and that the values are ranked, and thus should be always decreasing. We have at least 5 examples where the data is missing a period which causes it to be scaled improperly (10x larger than reality).</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>ocr_col1</span> <span class='op'>&lt;-</span> <span class='va'>no_grid</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://docs.ropensci.org/magick/reference/transform.html'>image_crop</a></span><span class='op'>(</span><span class='fu'><a href='https://docs.ropensci.org/magick/reference/geometry.html'>geometry_area</a></span><span class='op'>(</span><span class='fl'>80</span>, <span class='fl'>0</span>, <span class='fl'>80</span>, <span class='fl'>20</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://docs.ropensci.org/magick/reference/ocr.html'>ocr</a></span><span class='op'>(</span>engine <span class='op'>=</span> <span class='va'>num_only</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>str_split</span><span class='op'>(</span>pattern <span class='op'>=</span> <span class='st'>"\n"</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://rdrr.io/r/base/unlist.html'>unlist</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>enframe</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>value <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/double.html'>as.double</a></span><span class='op'>(</span><span class='va'>value</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>value</span><span class='op'>)</span><span class='op'>)</span>

<span class='va'>ocr_col1</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>color <span class='op'>=</span> <span class='fu'>case_when</span><span class='op'>(</span>
    <span class='va'>value</span> <span class='op'>&gt;</span> <span class='fl'>100</span> <span class='op'>~</span> <span class='st'>"red"</span>,
    <span class='va'>value</span> <span class='op'>&gt;</span> <span class='fu'><a href='https://rdrr.io/r/stats/lag.html'>lag</a></span><span class='op'>(</span><span class='va'>value</span><span class='op'>)</span> <span class='op'>~</span> <span class='st'>"red"</span>,
    <span class='va'>value</span> <span class='op'>&gt;</span> <span class='fu'><a href='https://rdrr.io/r/stats/lag.html'>lag</a></span><span class='op'>(</span><span class='va'>value</span>, n <span class='op'>=</span> <span class='fl'>3</span><span class='op'>)</span> <span class='op'>~</span> <span class='st'>"red"</span>,
    <span class='cn'>TRUE</span> <span class='op'>~</span> <span class='st'>"black"</span>
  <span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>ggplot</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>name</span>, y <span class='op'>=</span> <span class='va'>value</span>, color <span class='op'>=</span> <span class='va'>color</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_point</span><span class='op'>(</span>size <span class='op'>=</span> <span class='fl'>3</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>scale_color_identity</span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="reading-tables-from-images-with-magick_files/figure-html5/unnamed-chunk-31-1.png" width="624" /></p>
</div>
<p>Again, due to the VERY low image quality (the original image is 72 DPI and only ~500 pixels high) we’re basically stuck with some of these manual steps. Regardless, we’ve got “better” data now that we’ve added our conversion logic. Those same 5 points now fall “accurately” into the appropriate range.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>ocr_col1</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>mutate</span><span class='op'>(</span>color <span class='op'>=</span> <span class='fu'>case_when</span><span class='op'>(</span>
    <span class='va'>value</span> <span class='op'>&gt;</span> <span class='fl'>100</span> <span class='op'>~</span> <span class='st'>"red"</span>,
    <span class='va'>value</span> <span class='op'>&gt;</span> <span class='fu'><a href='https://rdrr.io/r/stats/lag.html'>lag</a></span><span class='op'>(</span><span class='va'>value</span><span class='op'>)</span> <span class='op'>~</span> <span class='st'>"red"</span>,
    <span class='va'>value</span> <span class='op'>&gt;</span> <span class='fu'><a href='https://rdrr.io/r/stats/lag.html'>lag</a></span><span class='op'>(</span><span class='va'>value</span>, n <span class='op'>=</span> <span class='fl'>3</span><span class='op'>)</span> <span class='op'>~</span> <span class='st'>"red"</span>,
    <span class='cn'>TRUE</span> <span class='op'>~</span> <span class='st'>"black"</span>
  <span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>mutate</span><span class='op'>(</span>
    value <span class='op'>=</span> <span class='fu'>if_else</span><span class='op'>(</span><span class='va'>value</span> <span class='op'>&gt;</span> <span class='fl'>100</span>, <span class='va'>value</span><span class='op'>/</span><span class='fl'>10</span>, <span class='va'>value</span><span class='op'>)</span>,
    value <span class='op'>=</span> <span class='fu'>if_else</span><span class='op'>(</span><span class='va'>name</span> <span class='op'>&gt;=</span> <span class='fl'>22</span>, <span class='va'>value</span><span class='op'>/</span><span class='fl'>10</span>, <span class='va'>value</span><span class='op'>)</span>
    <span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>ggplot</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>name</span>, y <span class='op'>=</span> <span class='va'>value</span>, color <span class='op'>=</span> <span class='va'>color</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_point</span><span class='op'>(</span>size <span class='op'>=</span> <span class='fl'>3</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>scale_color_identity</span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="reading-tables-from-images-with-magick_files/figure-html5/unnamed-chunk-32-1.png" width="624" /></p>
</div>
<p>So we’ve apparently “fixed” this column!</p>
<h2 id="create-a-function">Create a function</h2>
<p>We’ll create a function so that we can split out each column, apply optimal characters or numeric to each and then recombine.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>img_ocr_fun</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>trim_width</span>, <span class='va'>trim_start</span>, <span class='va'>char_num</span> <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span> <span class='op'>{</span>
  
  <span class='va'>num_only</span> <span class='op'>&lt;-</span> <span class='fu'>tesseract</span><span class='fu'>::</span><span class='fu'><a href='https://docs.ropensci.org/tesseract/reference/tesseract.html'>tesseract</a></span><span class='op'>(</span>
    options <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>tessedit_char_whitelist <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>".0123456789 "</span><span class='op'>)</span><span class='op'>)</span>
  <span class='op'>)</span>

  <span class='va'>combo</span> <span class='op'>&lt;-</span> <span class='fu'>tesseract</span><span class='fu'>::</span><span class='fu'><a href='https://docs.ropensci.org/tesseract/reference/tesseract.html'>tesseract</a></span><span class='op'>(</span>
    options <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>
      tessedit_char_whitelist <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span>
        <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>letters</span>, <span class='va'>LETTERS</span>, <span class='st'>" "</span>, <span class='st'>".0123456789 "</span><span class='op'>)</span>, collapse <span class='op'>=</span> <span class='st'>""</span><span class='op'>)</span>
      <span class='op'>)</span>
  <span class='op'>)</span>


  <span class='va'>input_char</span> <span class='op'>&lt;-</span> <span class='kw'>if</span> <span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/Logic.html'>isTRUE</a></span><span class='op'>(</span><span class='va'>char_num</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>{</span>
    <span class='va'>num_only</span>
  <span class='op'>}</span> <span class='kw'>else</span> <span class='op'>{</span>
    <span class='va'>combo</span>
  <span class='op'>}</span>

  <span class='va'>no_grid</span> <span class='op'>%&gt;%</span>
    <span class='fu'><a href='https://docs.ropensci.org/magick/reference/transform.html'>image_crop</a></span><span class='op'>(</span><span class='fu'><a href='https://docs.ropensci.org/magick/reference/geometry.html'>geometry_area</a></span><span class='op'>(</span><span class='va'>trim_width</span>, <span class='fl'>0</span>, <span class='va'>trim_start</span>, <span class='fl'>20</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'><a href='https://docs.ropensci.org/magick/reference/ocr.html'>ocr</a></span><span class='op'>(</span>engine <span class='op'>=</span> <span class='va'>input_char</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'>str_split</span><span class='op'>(</span>pattern <span class='op'>=</span> <span class='st'>"\n"</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'><a href='https://rdrr.io/r/base/unlist.html'>unlist</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'>enframe</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'>select</span><span class='op'>(</span><span class='op'>-</span><span class='va'>name</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>value</span><span class='op'>)</span>, <span class='fu'>str_length</span><span class='op'>(</span><span class='va'>value</span><span class='op'>)</span> <span class='op'>&gt;</span> <span class='fl'>0</span><span class='op'>)</span>
<span class='op'>}</span>
</code></pre>
</div>
</div>
<p>We can “find” the columns by cropping specific areas. Note that I’ve “recombined” all of them with <code>image_append()</code> so that you can see that each section together completes the table.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>
  <span class='va'>no_grid</span> <span class='op'>%&gt;%</span>
    <span class='fu'><a href='https://docs.ropensci.org/magick/reference/transform.html'>image_crop</a></span><span class='op'>(</span><span class='fu'><a href='https://docs.ropensci.org/magick/reference/geometry.html'>geometry_area</a></span><span class='op'>(</span><span class='fl'>80</span>, <span class='fl'>0</span>, <span class='fl'>0</span>, <span class='fl'>20</span><span class='op'>)</span><span class='op'>)</span>,
  <span class='va'>no_grid</span> <span class='op'>%&gt;%</span>
    <span class='fu'><a href='https://docs.ropensci.org/magick/reference/transform.html'>image_crop</a></span><span class='op'>(</span><span class='fu'><a href='https://docs.ropensci.org/magick/reference/geometry.html'>geometry_area</a></span><span class='op'>(</span><span class='fl'>50</span>, <span class='fl'>0</span>, <span class='fl'>80</span>, <span class='fl'>20</span><span class='op'>)</span><span class='op'>)</span>,
  <span class='va'>no_grid</span> <span class='op'>%&gt;%</span>
    <span class='fu'><a href='https://docs.ropensci.org/magick/reference/transform.html'>image_crop</a></span><span class='op'>(</span><span class='fu'><a href='https://docs.ropensci.org/magick/reference/geometry.html'>geometry_area</a></span><span class='op'>(</span><span class='fl'>50</span>, <span class='fl'>0</span>, <span class='fl'>140</span>, <span class='fl'>20</span><span class='op'>)</span><span class='op'>)</span>,
  <span class='va'>no_grid</span> <span class='op'>%&gt;%</span>
    <span class='fu'><a href='https://docs.ropensci.org/magick/reference/transform.html'>image_crop</a></span><span class='op'>(</span><span class='fu'><a href='https://docs.ropensci.org/magick/reference/geometry.html'>geometry_area</a></span><span class='op'>(</span><span class='fl'>50</span>, <span class='fl'>0</span>, <span class='fl'>210</span>, <span class='fl'>20</span><span class='op'>)</span><span class='op'>)</span>
<span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://docs.ropensci.org/magick/reference/animation.html'>image_append</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://docs.ropensci.org/magick/reference/image_ggplot.html'>image_ggplot</a></span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="reading-tables-from-images-with-magick_files/figure-html5/unnamed-chunk-34-1.png" width="624" /></p>
</div>
<h2 id="apply-the-function">Apply the function</h2>
<p>We can use <code>purrr::pmap()</code> to apply the functions with each of our parameters, and then use <code>bind_cols</code> to create our actual dataset.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>all_ocr</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>trim_width <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>80</span>, <span class='fl'>50</span>, <span class='fl'>50</span>, <span class='fl'>50</span><span class='op'>)</span>,
     trim_start <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>80</span>, <span class='fl'>140</span>, <span class='fl'>210</span><span class='op'>)</span>,
     char_num <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='cn'>FALSE</span>, <span class='cn'>TRUE</span>, <span class='cn'>FALSE</span>, <span class='cn'>TRUE</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>pmap</span><span class='op'>(</span><span class='va'>img_ocr_fun</span><span class='op'>)</span> 

<span class='va'>data_df</span> <span class='op'>&lt;-</span> <span class='va'>all_ocr</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>bind_cols</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>set_names</span><span class='op'>(</span>nm <span class='op'>=</span> <span class='st'>"team"</span>, <span class='st'>"win"</span>, <span class='st'>"lose"</span>, <span class='st'>"leverage"</span><span class='op'>)</span> 

<span class='va'>data_df</span>
</code></pre>
</div>
<pre><code># A tibble: 25 x 4
   team      win   lose  leverage
   &lt;chr&gt;     &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;   
 1 Bills     100   99.3  07      
 2 Packers   100   100   0       
 3 Rams      100   98.9  11      
 4 Chiefs    100   100   0       
 5 Saints    100   100   0       
 6 Seahawks  100   977   23      
 7 Steelers  100   100   0       
 8 Buccaneer 99.5  92.6  69      
 9 Titans    97.6  18.7  18.9    
10 Colts     94.9  66.4  285     
# … with 15 more rows</code></pre>
</div>
<h2 id="clean-it-up-1">Clean it up</h2>
<p>We can convert some of the letters to their proper numeric. I intentionally used characters vs numeric on some columns as it “guesses” better in our really low quality image. I then add some logic to convert our numbers if decimal places are missing, and it gets VERY close, but is not perfect.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>data_df</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>mutate</span><span class='op'>(</span><span class='fu'>across</span><span class='op'>(</span><span class='va'>win</span><span class='op'>:</span><span class='va'>leverage</span>, <span class='op'>~</span><span class='fu'>str_replace</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/chartr.html'>tolower</a></span><span class='op'>(</span><span class='va'>.x</span><span class='op'>)</span>, <span class='st'>"s"</span>, <span class='st'>"5"</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>mutate</span><span class='op'>(</span><span class='fu'>across</span><span class='op'>(</span><span class='va'>win</span><span class='op'>:</span><span class='va'>leverage</span>, <span class='op'>~</span><span class='fu'>str_replace</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/chartr.html'>tolower</a></span><span class='op'>(</span><span class='va'>.x</span><span class='op'>)</span>, <span class='st'>"o|a"</span>, <span class='st'>"0"</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>mutate</span><span class='op'>(</span><span class='fu'>across</span><span class='op'>(</span><span class='va'>win</span><span class='op'>:</span><span class='va'>leverage</span>, <span class='va'>as.double</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>mutate</span><span class='op'>(</span><span class='fu'>across</span><span class='op'>(</span><span class='va'>win</span><span class='op'>:</span><span class='va'>leverage</span>, <span class='op'>~</span><span class='fu'>if_else</span><span class='op'>(</span><span class='va'>.x</span> <span class='op'>&gt;</span> <span class='fl'>100</span>, <span class='va'>.x</span><span class='op'>/</span><span class='fl'>10</span>, <span class='va'>.x</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>mutate</span><span class='op'>(</span>lose <span class='op'>=</span> <span class='fu'>if_else</span><span class='op'>(</span><span class='va'>lose</span> <span class='op'>&gt;</span> <span class='va'>win</span>, <span class='va'>lose</span><span class='op'>/</span><span class='fl'>10</span>, <span class='va'>lose</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>mutate</span><span class='op'>(</span>leverage <span class='op'>=</span> <span class='va'>win</span> <span class='op'>-</span> <span class='va'>lose</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='op'>(</span>n <span class='op'>=</span> <span class='fl'>25</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code># A tibble: 25 x 4
   team         win  lose leverage
   &lt;chr&gt;      &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;
 1 Bills      100    99.3     0.7 
 2 Packers    100   100       0   
 3 Rams       100    98.9     1.10
 4 Chiefs     100   100       0   
 5 Saints     100   100       0   
 6 Seahawks   100    97.7     2.30
 7 Steelers   100   100       0   
 8 Buccaneer   99.5  92.6     6.9 
 9 Titans      97.6  18.7    78.9 
10 Colts       94.9  66.4    28.5 
11 Browns      94.6  67.5    27.1 
12 Ravens      90.1  51.8    38.3 
13 Football T  88.6  38.3    50.3 
14 Cardinals   65.7  28.7    37   
15 Dolphins    48.7  13.4    35.3 
16 Giants      41.3  10      31.3 
17 Bears       35.3  18      17.3 
18 Vikings     31.7   4.3    27.4 
19 Raiders     29.1   4.5    24.6 
20 Eagles      18.3   3.4    14.9 
21 49ers       14.5   5       9.5 
22 Patriots    58     0      58   
23 Cowboys     23     0      23   
24 ions        19     0      19   
25 Panthers     1     0       1   </code></pre>
</div>
<p>It looks really good, and it really only messed up a few rows, which we could fix manually, but you can see that while these techniques are robust you are still at the mercy of image quality!</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r distill-force-highlighting-css"><code class="sourceCode r"></code></pre></div>
<!--radix_placeholder_article_footer-->
<div class="article-footer">
  <p class="social_footer">
    <span class="article-sharing">
      Share: &nbsp;
      <a href="https://twitter.com/share?text=Reading%20tables%20from%20images%20with%20magick&amp;url=https%3A%2F%2Fthemockup.blog%2Fposts%2F2021-01-18-reading-tables-from-images-with-magick%2F">
        <i class="fab fa-twitter"></i>
      </a>
      <a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3A%2F%2Fthemockup.blog%2Fposts%2F2021-01-18-reading-tables-from-images-with-magick%2F&amp;title=Reading%20tables%20from%20images%20with%20magick">
        <i class="fab fa-linkedin"></i>
      </a>
    </span>
  </p>
  <p>
    <div class="subscribe"><a href="https://www.buymeacoffee.com/thomasmock">
    <img src="https://www.buymeacoffee.com/assets/img/custom_images/orange_img.png" alt="Buy Me A Coffee">
</a></div>
  </p>
</div>
<!--/radix_placeholder_article_footer-->
</div>

<div class="d-appendix">
</div>


<!--radix_placeholder_site_after_body-->
<!--/radix_placeholder_site_after_body-->
<!--radix_placeholder_appendices-->
<div class="appendix-bottom">
  <h3 id="citation">Citation</h3>
  <p>For attribution, please cite this work as</p>
  <pre class="citation-appendix short">Mock (2021, Jan. 18). The Mockup Blog: Reading tables from images with magick. Retrieved from https://themockup.blog/posts/2021-01-18-reading-tables-from-images-with-magick/</pre>
  <p>BibTeX citation</p>
  <pre class="citation-appendix long">@misc{mock2021reading,
  author = {Mock, Thomas},
  title = {The Mockup Blog: Reading tables from images with magick},
  url = {https://themockup.blog/posts/2021-01-18-reading-tables-from-images-with-magick/},
  year = {2021}
}</pre>
</div>
<!--/radix_placeholder_appendices-->
<!--radix_placeholder_navigation_after_body-->
<!--/radix_placeholder_navigation_after_body-->

</body>

</html>
